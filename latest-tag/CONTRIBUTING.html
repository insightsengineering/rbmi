<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Contributing to rbmi • rbmi</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><script src="deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Contributing to rbmi">
<meta property="og:image" content="/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">rbmi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/advanced.html">rbmi: Advanced Functionality</a></li>
    <li><a class="dropdown-item" href="articles/CondMean_Inference.html">rbmi: Inference with Conditional Mean Imputation</a></li>
    <li><a class="dropdown-item" href="articles/FAQ.html">rbmi: Frequently Asked Questions</a></li>
    <li><a class="dropdown-item" href="articles/quickstart.html">rbmi: Quickstart</a></li>
    <li><a class="dropdown-item" href="articles/retrieved_dropout.html">rbmi: Implementation of retrieved-dropout models using rbmi</a></li>
    <li><a class="dropdown-item" href="articles/stat_specs.html">rbmi: Statistical Specifications</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      <div><li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-versions">Versions</a>
    <div class="dropdown-menu" aria-labelledby="dropdown-versions">
    <a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rbmi/main">main</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rbmi/latest-tag">latest-tag</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rbmi/v1.3.1">v1.3.1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rbmi/v1.3.0">v1.3.0</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rbmi/v1.2.6">v1.2.6</a>
</div>
</li></div>
</ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/insightsengineering/rbmi/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="logo.png" class="logo" alt=""><h1>Contributing to rbmi</h1>
      <small class="dont-index">Source: <a href="https://github.com/insightsengineering/rbmi/blob/v1.3.1/CONTRIBUTING.md" class="external-link"><code>CONTRIBUTING.md</code></a></small>
    </div>

<div id="contributing-to-rbmi" class="section level1">

<p>This file outlines how to propose and make changes to <code>rbmi</code> as well as providing details about more obscure aspects of the package’s development process.</p>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>In order to develop or contribute to <code>rbmi</code> you will need to access to a C/C++ compiler. If you are on Windows you should install <a href="https://cran.r-project.org/bin/windows/Rtools/rtools42/rtools.html" class="external-link">rtools</a> or if you are on macOS you should install <a href="https://apps.apple.com/us/app/xcode/id497799835?mt=12" class="external-link">Xcode</a>. Likewise, you will also need to install all of the package’s development dependencies. This can be done by launching R from within the project root and executing:</p>
<pre><code><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/install_deps.html" class="external-link">install_dev_deps</a></span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="code-changes">Code changes<a class="anchor" aria-label="anchor" href="#code-changes"></a>
</h2>
<p>If you want to make a code contribution, it’s a good idea to first file an issue and make sure someone from the team agrees that it’s needed. If you’ve found a bug, please file an issue that illustrates the bug with a minimal <a href="https://www.tidyverse.org/help/#reprex" class="external-link">reprex</a> (this will also help you write a unit test, if needed).</p>
<div class="section level3">
<h3 id="pull-request-process">Pull request process<a class="anchor" aria-label="anchor" href="#pull-request-process"></a>
</h3>
<ul>
<li><p>This project uses a simple GitHub flow model for development. That is, code changes should be done in their own feature branch based off of the <code>main</code> branch and merged back into the <code>main</code> branch once complete.</p></li>
<li><p>Pull Requests will not be accepted unless all CI/CD checks have passed. (See the CI/CD section for more information).</p></li>
<li><p>Pull Requests relating to any of the package’s core R code must be accompanied by a corresponding unit test. Any pull requests containing changes to the core R code that do not contain a unit test to demonstrate that it is working as intended will not be accepted. (See the Unit Testing section for more information).</p></li>
<li><p>Pull Requests should add a few lines about what has been changed to the <code>NEWS.md</code> file.</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="coding-considerations">Coding Considerations<a class="anchor" aria-label="anchor" href="#coding-considerations"></a>
</h3>
<ul>
<li><p>We use <a href="https://cran.r-project.org/package=roxygen2" class="external-link">roxygen2</a>, with <a href="https://cran.r-project.org/web/packages/roxygen2/vignettes/rd-formatting.html" class="external-link">Markdown syntax</a>, for documentation.</p></li>
<li><p>Please ensure your code conforms to <a href="https://cran.r-project.org/web/packages/lintr/readme/README.html#available-linters" class="external-link">lintr</a>. You can check this by running <code>lintr::lint("FILE NAME")</code> on any files you have modified and ensuring that the findings are kept to as few as possible. We do not have any hard requirements on following <code>lintr</code>’s conventions but do encourage developers to follow its guidance as closely as possible.</p></li>
<li><p>This project uses 4 space indents, contributions not following this will not be accepted.</p></li>
<li><p>This project makes use of <a href="https://adv-r.hadley.nz/s3.html" class="external-link">S3</a> and <a href="https://adv-r.hadley.nz/r6.html" class="external-link">R6</a> for OOP. Usage of S4 and other OOP systems should be avoided unless absolutely necessary to ensure consistency. Having said that it is recommended to stick to S3 unless modification in place or other R6 specific features are required.</p></li>
<li><p>The current desire of this package is to keep the dependency tree as small as possible. To that end you are discouraged from adding any additional packages to the “Depends” / “Imports” section unless absolutely essential. If you are importing a package just to use a single function then consider just copying the source code of that function instead, though please check the licence and include proper attribution/notices. There are no such expectations for “Suggests” and you are free to use any package in the vignettes / unit tests, though again please be mindful to not be unnecessarily excessive with this.</p></li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="unit-testing--cicd">Unit Testing &amp; CI/CD<a class="anchor" aria-label="anchor" href="#unit-testing--cicd"></a>
</h2>
<p>This project uses <code>testthat</code> to perform unit testing in combination with GitHub Actions for CI/CD.</p>
<div class="section level3">
<h3 id="scheduled-testing">Scheduled Testing<a class="anchor" aria-label="anchor" href="#scheduled-testing"></a>
</h3>
<p>Due to the stochastic nature of this package some unit tests take a considerable amount of time to execute. To avoid issues with usability, unit tests that take more than a couple of seconds to run should be deferred to the scheduled testing. These are tests that are only run occasionally on a periodic basis (currently twice a month) and not on every pull request / push event.</p>
<p>To defer a test to the scheduled build simply include <code>skip_if_not(is_full_test())</code> to the top of the <code>test_that()</code> block i.e.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">test_that</span><span class="op">(</span><span class="st">"some unit test"</span>, <span class="op">{</span></span>
<span>    <span class="fu">skip_if_not</span><span class="op">(</span><span class="fu">is_full_test</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu">expect_equal</span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>The scheduled tests can also be manually activated by going to “<a href="https://github.com/insightsengineering/rbmi" class="external-link uri">https://github.com/insightsengineering/rbmi</a>” -&gt; “Actions” -&gt; “Bi-Weekly” -&gt; “Run Workflow”. It is advisable to do this before releasing to CRAN.</p>
</div>
<div class="section level3">
<h3 id="docker-images">Docker Images<a class="anchor" aria-label="anchor" href="#docker-images"></a>
</h3>
<p>To support CI/CD, in terms of reducing setup time, a Docker images has been created which contains all the packages and system dependencies required for this project. The image can be found at:</p>
<ul>
<li>ghcr.io/insightsengineering/rbmi:latest</li>
</ul>
<p>This image is automatically re-built once a month to contain the latest version of R and its packages. The code to create this images can be found in <code>misc/docker</code>.</p>
<p>To build the image locally run the following from the project root directory:</p>
<pre><code>docker build -f misc/docker/Dockerfile  -t rbmi:latest .</code></pre>
</div>
<div class="section level3">
<h3 id="reproducibility-print-tests--snaps">Reproducibility, Print Tests &amp; Snaps<a class="anchor" aria-label="anchor" href="#reproducibility-print-tests--snaps"></a>
</h3>
<p>A particular issue with testing this package is reproducibility. For the most part this is handled well via <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed()</a></code> however <code>stan</code>/<code>rstan</code> does <a href="https://mc-stan.org/docs/2_29/reference-manual/reproducibility.html" class="external-link">not guarantee reproducibility</a> even with the same seed if run on different hardware.</p>
<p>This issue surfaces itself when testing the print messages of the <code>pool</code> object which displays treatment estimates which are thus not identical when run on different machines. To address this issue pre-made <code>pool</code> objects have been generated and stored in <code>R/sysdata.rda</code> (which itself is generated by <code>data-raw/create_print_test_data.R</code>). The generated print messages are compared to expected values which are stored in <code>tests/testthat/_snaps/</code> (which themselves are automatically created by <code><a href="https://testthat.r-lib.org/reference/expect_snapshot.html" class="external-link">testthat::expect_snapshot()</a></code>)</p>
</div>
</div>
<div class="section level2">
<h2 id="fitting-mmrms">Fitting MMRM’s<a class="anchor" aria-label="anchor" href="#fitting-mmrms"></a>
</h2>
<p>This package currently uses the <code>mmrm</code> package to fit MMRM models. This package is still fairly new but has so far proven to be very stable, fast and reliable. If you do spot any issues with the MMRM package please do raise them in the corresponding GitHub Repository - <a href="https://github.com/openpharma/mmrm/issues" class="external-link">link</a></p>
<p>As the <code>mmrm</code> package uses <code>TMB</code> it is not uncommon to see warnings about either inconsistent versions between what <code>TMB</code> and the <code>Matrix</code> package were compiled as. In order to resolve this you may wish to re-compile these packages from source using:</p>
<pre><code><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TMB"</span>, <span class="st">"mmrm"</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"source"</span><span class="op">)</span></span></code></pre>
<p>Note that you will need to have <a href="https://cran.r-project.org/bin/windows/Rtools/rtools42/rtools.html" class="external-link">rtools</a> installed if you are on a Windows machine or <a href="https://apps.apple.com/us/app/xcode/id497799835?mt=12" class="external-link">Xcode</a> if you are running macOS (or somehow else have access to a C/C++ compiler).</p>
</div>
<div class="section level2">
<h2 id="rstan">rstan<a class="anchor" aria-label="anchor" href="#rstan"></a>
</h2>
<p>The Bayesian models fitted by this package are implemented via <a href="https://mc-stan.org/users/interfaces/rstan" class="external-link">stan/rstan</a>. The code for this can be found in <code>inst/stan/MMRM.stan</code>. Note that the package will automatically take care of compiling this code when you install it or run <code><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">devtools::load_all()</a></code>. Please note that the package won’t recompile the code unless you have changed the source code or you delete the <code>src</code> directory.</p>
</div>
<div class="section level2">
<h2 id="vignettes">Vignettes<a class="anchor" aria-label="anchor" href="#vignettes"></a>
</h2>
<p>CRAN imposes a 10-minute run limit on building, compiling and testing your package. To keep to this limit the vignettes are pre-built; that is to say that simply changing the source code will not automatically update the vignettes, you will need to manually re-build them.</p>
<p>To do this you need to run:</p>
<pre><code>Rscript vignettes/build.R</code></pre>
<p>Once re-built you will then need to commit the updated <code>*.html</code> files to the git repository.</p>
<p>For reference this static vignette process works by using the “asis” vignette engine provided by <code>R.rsp</code>. This works by getting R to only recognise vignettes as files ending in <code>*.html.asis</code>; it then builds them by simply copying the corresponding files ending in <code>*.html</code> to the relevent <code>docs/</code> folder in the built package.</p>
</div>
<div class="section level2">
<h2 id="misc--local-folders">Misc &amp; Local Folders<a class="anchor" aria-label="anchor" href="#misc--local-folders"></a>
</h2>
<p>The <code>misc/</code> folder in this project is used to hold useful scripts, analyses, simulations &amp; infrastructure code that we wish to keep but isn’t essential to the build or deployment of the package. Feel free to store additional stuff in here that you feel is worth keeping.</p>
<p>Likewise, <code>local/</code> has been added to the <code>.gitignore</code> file meaning anything stored in this folder won’t be committed to the repository. For example, you may find this useful for storing personal scripts for testing or more generally exploring the package during development.</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Craig Gower-Page, Alessandro Noci, Isaac Gravestock, F. Hoffmann-La Roche AG.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
