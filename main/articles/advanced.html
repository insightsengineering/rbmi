<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>rbmi: Advanced Functionality • rbmi</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="rbmi: Advanced Functionality">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rbmi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.6.0001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/advanced.html">rbmi: Advanced Functionality</a></li>
    <li><a class="dropdown-item" href="../articles/CondMean_Inference.html">rbmi: Inference with Conditional Mean Imputation</a></li>
    <li><a class="dropdown-item" href="../articles/FAQ.html">rbmi: Frequently Asked Questions</a></li>
    <li><a class="dropdown-item" href="../articles/quickstart.html">rbmi: Quickstart</a></li>
    <li><a class="dropdown-item" href="../articles/retrieved_dropout.html">rbmi: Implementation of retrieved-dropout models using rbmi</a></li>
    <li><a class="dropdown-item" href="../articles/stat_specs.html">rbmi: Statistical Specifications</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<!-- start dropdown for versions --> <li class="nav-item dropdown">
        <a href="#" class="nav-link dropdown-toggle"
          data-bs-toggle="dropdown" role="button"
          aria-expanded="false" aria-haspopup="true"
          id="dropdown-versions">Versions</a> <div class="dropdown-menu" aria-labelledby="dropdown-versions"> <a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rbmi/main">main</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rbmi/latest-tag">latest-tag</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rbmi/v1.2.6">v1.2.6</a> </div></li>
<!-- end dropdown for versions -->

<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/insightsengineering/rbmi/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>rbmi: Advanced Functionality</h1>
                        <h4 data-toc-skip class="author">Alessandro Noci, Craig Gower-Page, and Marcel Wolbers</h4>


      <small class="dont-index">Source: <a href="https://github.com/insightsengineering/rbmi/blob/main/vignettes/advanced.Rmd" class="external-link"><code>vignettes/advanced.Rmd</code></a></small>
      <div class="d-none name"><code>advanced.Rmd</code></div>
    </div>



<div class="section level2" number="1">
<h2 id="introduction">
<span class="header-section-number">1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The purpose of this vignette is to provide an overview of some more advanced features of the <code>rbmi</code> package.
The sections of the vignette are relatively self-contained, i.e. readers should be able to jump directly to the section which covers the functionality that they are most interested in.</p>
</div>
<div class="section level2" number="2">
<h2 id="sec:dataSimul">
<span class="header-section-number">2</span> Data simulation using function <code>simulate_data()</code><a class="anchor" aria-label="anchor" href="#sec:dataSimul"></a>
</h2>
<p>In order to demonstrate the advanced functions we will first create a simulated dataset with the <code>rbmi</code> function <code><a href="../reference/simulate_data.html">simulate_data()</a></code>.
The <code><a href="../reference/simulate_data.html">simulate_data()</a></code> function generates data from a randomized clinical trial with longitudinal continuous outcomes and up to two different types of intercurrent events (ICEs).
One intercurrent event (ICE1) may be thought of as a discontinuation from study treatment due to study drug or condition related (SDCR) reasons.
The other event (ICE2) may be thought of as discontinuation from study treatment due to not study drug or condition related (NSDCR) reasons.
For the purpose of this vignette, we simulate data similarly to the simulation study reported in <span class="citation">Wolbers et al. (<a href="#ref-Wolbers2021">2022</a>)</span> (though we change some of the simulation parameters) and include only one ICE type (ICE1).</p>
<p>Specifically, we simulate a 1:1 randomized trial of an active drug (intervention) versus placebo (control) with 100 subjects per group and 6 post-baseline assessments (bi-monthly visits until 12 months) under the following assumptions:</p>
<ul>
<li>The mean outcome trajectory in the placebo group increases linearly from 50 at baseline (visit 0) to 60 at visit 6, i.e. the slope is 10 points/year.</li>
<li>The mean outcome trajectory in the intervention group is identical to the placebo group up to visit 2. From visit 2 onward, the slope decreases by 50% to 5 points/year.</li>
<li>The covariance structure of the baseline and follow-up values in both groups is implied by a random intercept and slope model with a standard deviation of 5 for both the intercept and the slope, and a correlation of 0.25. In addition, an independent residual error with standard deviation 2.5 is added to each assessment.<br>
</li>
<li>The probability of study drug discontinuation after each visit is calculated according to a logistic model which depends on the observed outcome at that visit. Specifically, a visit-wise discontinuation probability of 2% and 3% in the control and intervention group, respectively, is specified in case the observed outcome is equal to 50 (the mean value at baseline). The odds of a discontinuation is simulated to increase by +10% for each +1 point increase of the observed outcome.</li>
<li>Study drug discontinuation is simulated to have no effect on the mean trajectory in the placebo group. In the intervention group, subjects who discontinue follow the slope of the mean trajectory from the placebo group from that time point onward. This is compatible with a copy increments in reference (CIR) assumption.</li>
<li>Study drop-out at the study drug discontinuation visit occurs with a probability of 50% leading to missing outcome data from that time point onward.</li>
</ul>
<p>The function <code><a href="../reference/simulate_data.html">simulate_data()</a></code> requires 3 arguments (see the function documentation <code><a href="../reference/simulate_data.html">help(simulate_data)</a></code> for more details):</p>
<ul>
<li>
<code>pars_c</code>: The simulation parameters of the control group</li>
<li>
<code>pars_t</code>: The simulation parameters of the intervention group</li>
<li>
<code>post_ice1_traj</code>: Specifies how observed outcomes after ICE1 are simulated</li>
</ul>
<p>Below, we report how data according to the specifications above can be simulated with function <code><a href="../reference/simulate_data.html">simulate_data()</a></code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://insightsengineering.github.io/rbmi/" class="external-link">rbmi</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">122</span><span class="op">)</span></span>
<span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">8</span>, <span class="fl">10</span>, <span class="fl">12</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Mean trajectory control</span></span>
<span><span class="va">muC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50.0</span>, <span class="fl">51.66667</span>, <span class="fl">53.33333</span>, <span class="fl">55.0</span>, <span class="fl">56.66667</span>, <span class="fl">58.33333</span>, <span class="fl">60.0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Mean trajectory intervention</span></span>
<span><span class="va">muT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50.0</span>, <span class="fl">51.66667</span>, <span class="fl">53.33333</span>, <span class="fl">54.16667</span>, <span class="fl">55.0</span>, <span class="fl">55.83333</span>, <span class="fl">56.66667</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create Sigma</span></span>
<span><span class="va">sd_error</span> <span class="op">&lt;-</span> <span class="fl">2.5</span></span>
<span><span class="va">covRE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25.0</span>, <span class="fl">6.25</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6.25</span>, <span class="fl">25.0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">Sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">time</span> <span class="op">/</span> <span class="fl">12</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">covRE</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">time</span> <span class="op">/</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">sd_error</span><span class="op">^</span><span class="fl">2</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set probability of discontinuation</span></span>
<span><span class="va">probDisc_C</span> <span class="op">&lt;-</span> <span class="fl">0.02</span></span>
<span><span class="va">probDisc_T</span> <span class="op">&lt;-</span> <span class="fl">0.03</span></span>
<span><span class="va">or_outcome</span> <span class="op">&lt;-</span> <span class="fl">1.10</span> <span class="co"># +1 point increase =&gt; +10% odds of discontinuation</span></span>
<span></span>
<span><span class="co"># Set drop-out rate following discontinuation</span></span>
<span><span class="va">prob_dropout</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span></span>
<span><span class="co"># Set simulation parameters of the control group</span></span>
<span><span class="va">parsC</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_simul_pars.html">set_simul_pars</a></span><span class="op">(</span></span>
<span>    mu <span class="op">=</span> <span class="va">muC</span>,</span>
<span>    sigma <span class="op">=</span> <span class="va">Sigma</span>,</span>
<span>    n <span class="op">=</span> <span class="va">n</span>,</span>
<span>    prob_ice1 <span class="op">=</span> <span class="va">probDisc_C</span>,</span>
<span>    or_outcome_ice1 <span class="op">=</span> <span class="va">or_outcome</span>,</span>
<span>    prob_post_ice1_dropout <span class="op">=</span> <span class="va">prob_dropout</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set simulation parameters of the intervention group</span></span>
<span><span class="va">parsT</span> <span class="op">&lt;-</span> <span class="va">parsC</span></span>
<span><span class="va">parsT</span><span class="op">$</span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="va">muT</span></span>
<span><span class="va">parsT</span><span class="op">$</span><span class="va">prob_ice1</span> <span class="op">&lt;-</span> <span class="va">probDisc_T</span></span>
<span></span>
<span><span class="co"># Set assumption about post-ice trajectory</span></span>
<span><span class="va">post_ice_traj</span> <span class="op">&lt;-</span> <span class="st">"CIR"</span></span>
<span></span>
<span><span class="co"># Simulate data</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_data.html">simulate_data</a></span><span class="op">(</span></span>
<span>    pars_c <span class="op">=</span> <span class="va">parsC</span>,</span>
<span>    pars_t <span class="op">=</span> <span class="va">parsT</span>,</span>
<span>    post_ice1_traj <span class="op">=</span> <span class="va">post_ice_traj</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;     id visit   group outcome_bl outcome_noICE ind_ice1 ind_ice2 dropout_ice1</span></span>
<span><span class="co">#&gt; 1 id_1     0 Control   57.32704      57.32704        0        0            0</span></span>
<span><span class="co">#&gt; 2 id_1     1 Control   57.32704      54.69751        1        0            1</span></span>
<span><span class="co">#&gt; 3 id_1     2 Control   57.32704      58.60702        1        0            1</span></span>
<span><span class="co">#&gt; 4 id_1     3 Control   57.32704      61.50119        1        0            1</span></span>
<span><span class="co">#&gt; 5 id_1     4 Control   57.32704      56.68363        1        0            1</span></span>
<span><span class="co">#&gt; 6 id_1     5 Control   57.32704      66.14799        1        0            1</span></span>
<span><span class="co">#&gt;    outcome</span></span>
<span><span class="co">#&gt; 1 57.32704</span></span>
<span><span class="co">#&gt; 2       NA</span></span>
<span><span class="co">#&gt; 3       NA</span></span>
<span><span class="co">#&gt; 4       NA</span></span>
<span><span class="co">#&gt; 5       NA</span></span>
<span><span class="co">#&gt; 6       NA</span></span>
<span></span>
<span><span class="co"># As a simple descriptive of the simulated data, summarize the number of subjects with ICEs and missing data </span></span>
<span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    group <span class="op">=</span> <span class="va">group</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    any_ICE <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">ind_ice1</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    any_NA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>      subjects_with_ICE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">any_ICE</span><span class="op">)</span>,</span>
<span>      subjects_with_missings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">any_NA</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 3</span></span></span>
<span><span class="co">#&gt;   group        subjects_with_ICE subjects_with_missings</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>                    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Control                     18                      8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Intervention                25                     14</span></span></code></pre></div>
</div>
<div class="section level2" number="3">
<h2 id="sec:postICEobs">
<span class="header-section-number">3</span> Handling of observed post-ICE data in <code>rbmi</code> under reference-based imputation<a class="anchor" aria-label="anchor" href="#sec:postICEobs"></a>
</h2>
<p><code>rbmi</code> always uses all non-missing outcome data from the input data set, i.e. such data are never overwritten during the imputation step or removed from the analysis step. This implies that if there are data which are considered to be irrelevant for treatment effect estimation (e.g. data after an ICE for which the estimand specified a hypothetical strategy), then such data need to be removed from the input data set by the user prior to calling the <code>rbmi</code> functions.</p>
<p>For imputation under a missing at random (<code>MAR</code>) strategy, all observed outcome data is also included in the fitting of the base imputation model. However, for ICEs handled using reference-based imputation methods (such as <code>CIR</code>, <code>CR</code>, and <code>JR</code>), <code>rbmi</code> excludes observed post-ICE data from the base imputation model. If these data were not excluded, then the base imputation model would mistakenly estimate mean trajectories based on a mixture of observed pre- and post-ICE data which are not relevant for reference-based imputations. However, any observed post-ICE data are added back into the data set after the fitting of the base imputation model and included as is in the subsequent imputation and analysis steps.</p>
<p>Post-ICE data in the control or reference group are also excluded from the base imputation model if the user specifies a reference-based imputation strategy for such ICEs. This ensures that an ICE has the same impact on the data included in the base imputation model regardless whether the ICE occurred in the control or the intervention group. On the other hand, imputation in the reference group is based on a MAR assumption even for reference-based imputation methods and it may be preferable in some settings to include such post-ICE data from the control group in the base imputation model. This can be implemented by specifying a <code>MAR</code> strategy for the ICE in the control group and a reference-based strategy for the same ICE in the intervention group. We will use this latter approach in our example below.</p>
<p>The simulated trial data from section <a href="#sec:dataSimul">2</a> assumed that outcomes in the intervention group observed after the ICE “treatment discontinuation” follow the increments observed in the control group. Thus the imputation of missing data in the intervention group after treatment discontinuation might be performed under a reference-based copy increments in reference (<code>CIR</code>) assumption.</p>
<p>Specifically, we implement an estimator under the following assumptions:</p>
<ul>
<li>The endpoint of interest is the change in the outcome from baseline at each visit.</li>
<li>The imputation model includes the treatment group, the (categorical) visit, treatment-by-visit interactions, the baseline outcome, and baseline outcome-by-visit interactions as covariates.</li>
<li>The imputation model assumes a common unstructured covariance matrix in both treatment groups</li>
<li>In the control group, all missing data are imputed under MAR whereas in the intervention group, missing post-ICE data are imputed under a CIR assumption</li>
<li>The analysis model of the endpoint in the imputed datasets is a separate ANCOVA model for each visit with the treatment group as the primary covariate and adjustment for the baseline outcome value.</li>
</ul>
<p>For illustration purposes, we chose MI based on approximate Bayesian posterior draws with 20 random imputations which is not very demanding from a computational perspective. In practical applications, the number of random imputations may need to be increased. Moreover, other imputations are also supported in <code>rbmi</code>. For guidance regarding the choice of the imputation approach, we refer the user to a comparison between all implemented approaches in Section 3.9 of the “Statistical Specifications” vignette (<code><a href="../articles/stat_specs.html">vignette("stat_specs", package = "rbmi")</a></code>).</p>
<p>We first report the code to set the variables of the imputation and analysis models. If you are not yet familiar with the syntax, we recommend that you first check the “quickstart” vignette (<code><a href="../articles/quickstart.html">vignette("quickstart", package = "rbmi")</a></code>).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create data_ice including the subject's first visit affected by the ICE and the imputation strategy</span></span>
<span><span class="co"># Imputation strategy for post-ICE data is CIR in the intervention group and MAR for the control group </span></span>
<span><span class="co"># (note that ICEs which are handled using MAR are optional and do not impact the analysis</span></span>
<span><span class="co">#  because imputation of missing data under MAR is the default)</span></span>
<span><span class="va">data_ice_CIR</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ind_ice1</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># select visits with ICEs</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>strategy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">group</span> <span class="op">==</span> <span class="st">"Intervention"</span>, <span class="st">"CIR"</span>, <span class="st">"MAR"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>        visit <span class="op">=</span> <span class="va">visit</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="co"># Select first visit affected by the ICE</span></span>
<span>        strategy <span class="op">=</span> <span class="va">strategy</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute endpoint of interest: change from baseline and</span></span>
<span><span class="co"># remove rows corresponding to baseline visits</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">visit</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        change <span class="op">=</span> <span class="va">outcome</span> <span class="op">-</span> <span class="va">outcome_bl</span>,</span>
<span>        visit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">visit</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">visit</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co"># Define key variables for the imputation and analysis models</span></span>
<span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_vars.html">set_vars</a></span><span class="op">(</span></span>
<span>    subjid <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>    visit <span class="op">=</span> <span class="st">"visit"</span>,</span>
<span>    outcome <span class="op">=</span> <span class="st">"change"</span>,</span>
<span>    group <span class="op">=</span> <span class="st">"group"</span>,</span>
<span>    covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"visit*outcome_bl"</span>, <span class="st">"visit*group"</span><span class="op">)</span>,</span>
<span>    strategy <span class="op">=</span> <span class="st">"strategy"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">vars_an</span> <span class="op">&lt;-</span> <span class="va">vars</span></span>
<span><span class="va">vars_an</span><span class="op">$</span><span class="va">covariates</span> <span class="op">&lt;-</span> <span class="st">"outcome_bl"</span></span></code></pre></div>
<p>The chosen imputation method can be set with the function <code><a href="../reference/method.html">method_approxbayes()</a></code> as follows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">method</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/method.html">method_approxbayes</a></span><span class="op">(</span>n_sample <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code></pre></div>
<p>We can now sequentially call the 4 key functions of <code>rbmi</code> to perform the multiple imputation. Please note that the management of observed post-ICE data is performed without additional complexity for the user. <code><a href="../reference/draws.html">draws()</a></code> automatically excludes post-ICE data handled with a reference-based method (but keeps post-ICE data handled using MAR) using information provided by the argument <code>data_ice</code>. <code><a href="../reference/impute.html">impute()</a></code> will impute only truly missing data in <code>data[[vars$outcome]]</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">draw_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draws.html">draws</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">data</span>,</span>
<span>    data_ice <span class="op">=</span> <span class="va">data_ice_CIR</span>,</span>
<span>    vars <span class="op">=</span> <span class="va">vars</span>,</span>
<span>    method <span class="op">=</span> <span class="va">method</span>,</span>
<span>    quiet <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    ncores <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">impute_obj_CIR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/impute.html">impute</a></span><span class="op">(</span></span>
<span>    <span class="va">draw_obj</span>,</span>
<span>    references <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Control"</span> <span class="op">=</span> <span class="st">"Control"</span>, <span class="st">"Intervention"</span> <span class="op">=</span> <span class="st">"Control"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ana_obj_CIR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyse.html">analyse</a></span><span class="op">(</span></span>
<span>    <span class="va">impute_obj_CIR</span>,</span>
<span>    vars <span class="op">=</span> <span class="va">vars_an</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">pool_obj_CIR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pool.html">pool</a></span><span class="op">(</span><span class="va">ana_obj_CIR</span><span class="op">)</span></span>
<span><span class="va">pool_obj_CIR</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Pool Object</span></span>
<span><span class="co">#&gt; -----------</span></span>
<span><span class="co">#&gt; Number of Results Combined: 20</span></span>
<span><span class="co">#&gt; Method: rubin</span></span>
<span><span class="co">#&gt; Confidence Level: 0.95</span></span>
<span><span class="co">#&gt; Alternative: two.sided</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Results:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   ==================================================</span></span>
<span><span class="co">#&gt;    parameter   est     se     lci     uci     pval  </span></span>
<span><span class="co">#&gt;   --------------------------------------------------</span></span>
<span><span class="co">#&gt;      trt_1    -0.486  0.512  -1.496  0.524   0.343  </span></span>
<span><span class="co">#&gt;    lsm_ref_1   2.62   0.362  1.907   3.333   &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_alt_1  2.133   0.362   1.42   2.847   &lt;0.001 </span></span>
<span><span class="co">#&gt;      trt_2    -0.066  0.542  -1.135  1.004   0.904  </span></span>
<span><span class="co">#&gt;    lsm_ref_2  3.707   0.384   2.95   4.464   &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_alt_2  3.641   0.383  2.885   4.397   &lt;0.001 </span></span>
<span><span class="co">#&gt;      trt_3    -1.782  0.607  -2.979  -0.585  0.004  </span></span>
<span><span class="co">#&gt;    lsm_ref_3  5.841   0.428  4.997   6.685   &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_alt_3  4.059   0.428  3.214   4.904   &lt;0.001 </span></span>
<span><span class="co">#&gt;      trt_4    -2.518  0.692  -3.884  -1.152  &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_ref_4  7.656   0.492  6.685   8.627   &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_alt_4  5.138   0.488  4.176    6.1    &lt;0.001 </span></span>
<span><span class="co">#&gt;      trt_5    -3.658  0.856  -5.346  -1.97   &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_ref_5  9.558   0.598  8.379   10.737  &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_alt_5   5.9    0.608  4.699   7.101   &lt;0.001 </span></span>
<span><span class="co">#&gt;      trt_6    -4.537  0.954  -6.42   -2.655  &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_ref_6  11.048  0.666  9.735   12.362  &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_alt_6  6.511   0.674  5.181   7.841   &lt;0.001 </span></span>
<span><span class="co">#&gt;   --------------------------------------------------</span></span></code></pre></div>
<p>This last output gives an estimated difference of
-4.537 (95% CI -6.420 to -2.655)
between the two groups at the last visit with an associated p-value lower than 0.001.</p>
</div>
<div class="section level2" number="4">
<h2 id="efficiently-changing-reference-based-imputation-strategies">
<span class="header-section-number">4</span> Efficiently changing reference-based imputation strategies<a class="anchor" aria-label="anchor" href="#efficiently-changing-reference-based-imputation-strategies"></a>
</h2>
<p>The <code><a href="../reference/draws.html">draws()</a></code> function is by far the most computationally intensive function in <code>rbmi</code>.
In some settings, it may be important to explore the impact of a change in the
reference-based imputation strategy on the results.
Such a change does not affect the imputation model but it does
affect the subsequent imputation step.
In order to allow changes in the imputation strategy without having to re-run the
<code><a href="../reference/draws.html">draws()</a></code> function, the function <code><a href="../reference/impute.html">impute()</a></code> has an additional argument <code>update_strategies</code>.</p>
<p>However, please note that this functionality comes with some important limitations:
As described at the beginning of Section <a href="#sec:postICEobs">3</a>, post-ICE outcomes are included in the input dataset for the base imputation model if the imputation method is <code>MAR</code> but they are excluded for reference-based imputation methods (such as <code>CIR</code>, <code>CR</code>, and <code>JR</code>).
Therefore, <code>updata_strategies</code> cannot be applied if the imputation strategy is changed from a MAR to a non-MAR strategy in the presence of observed post-ICE outcomes. Similarly, a change from a non-MAR strategy to MAR triggers a warning in the presence of observed post-ICE outcomes because the base imputation model was not fitted to all relevant data under MAR.
Finally, <code>update_strategies</code> cannot be applied if the timing of any of the ICEs is changed (in argument <code>data_ice</code>) in addition to the imputation strategy.</p>
<p>As an example, we described an analysis under a copy increments in reference (CIR) assumption in the previous section. Let’s assume we want to change this strategy to a jump to reference imputation strategy for a sensitivity analysis. This can be efficiently implemented using <code>update_strategies</code> as follows:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Change ICE strategy from CIR to JR</span></span>
<span><span class="va">data_ice_JR</span> <span class="op">&lt;-</span> <span class="va">data_ice_CIR</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>strategy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">strategy</span> <span class="op">==</span> <span class="st">"CIR"</span>, <span class="st">"JR"</span>, <span class="va">strategy</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">impute_obj_JR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/impute.html">impute</a></span><span class="op">(</span></span>
<span>    <span class="va">draw_obj</span>,</span>
<span>    references <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Control"</span> <span class="op">=</span> <span class="st">"Control"</span>, <span class="st">"Intervention"</span> <span class="op">=</span> <span class="st">"Control"</span><span class="op">)</span>,</span>
<span>    update_strategy <span class="op">=</span> <span class="va">data_ice_JR</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ana_obj_JR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyse.html">analyse</a></span><span class="op">(</span></span>
<span>    <span class="va">impute_obj_JR</span>,</span>
<span>    vars <span class="op">=</span> <span class="va">vars_an</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">pool_obj_JR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pool.html">pool</a></span><span class="op">(</span><span class="va">ana_obj_JR</span><span class="op">)</span></span>
<span><span class="va">pool_obj_JR</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Pool Object</span></span>
<span><span class="co">#&gt; -----------</span></span>
<span><span class="co">#&gt; Number of Results Combined: 20</span></span>
<span><span class="co">#&gt; Method: rubin</span></span>
<span><span class="co">#&gt; Confidence Level: 0.95</span></span>
<span><span class="co">#&gt; Alternative: two.sided</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Results:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   ==================================================</span></span>
<span><span class="co">#&gt;    parameter   est     se     lci     uci     pval  </span></span>
<span><span class="co">#&gt;   --------------------------------------------------</span></span>
<span><span class="co">#&gt;      trt_1    -0.485  0.513  -1.496  0.526   0.346  </span></span>
<span><span class="co">#&gt;    lsm_ref_1  2.609   0.363  1.892   3.325   &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_alt_1  2.124   0.361  1.412   2.836   &lt;0.001 </span></span>
<span><span class="co">#&gt;      trt_2    -0.06   0.535  -1.115  0.995   0.911  </span></span>
<span><span class="co">#&gt;    lsm_ref_2  3.694   0.378  2.948   4.441   &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_alt_2  3.634   0.381  2.882   4.387   &lt;0.001 </span></span>
<span><span class="co">#&gt;      trt_3    -1.767  0.598  -2.948  -0.587  0.004  </span></span>
<span><span class="co">#&gt;    lsm_ref_3  5.845   0.422  5.012   6.677   &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_alt_3  4.077   0.432  3.225    4.93   &lt;0.001 </span></span>
<span><span class="co">#&gt;      trt_4    -2.529  0.686  -3.883  -1.175  &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_ref_4  7.637   0.495  6.659   8.614   &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_alt_4  5.108   0.492  4.138   6.078   &lt;0.001 </span></span>
<span><span class="co">#&gt;      trt_5    -3.523  0.856  -5.212  -1.833  &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_ref_5  9.554   0.61   8.351   10.758  &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_alt_5  6.032   0.611  4.827   7.237   &lt;0.001 </span></span>
<span><span class="co">#&gt;      trt_6    -4.36   0.952  -6.238  -2.482  &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_ref_6  11.003  0.676  9.669   12.337  &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_alt_6  6.643   0.687  5.287     8     &lt;0.001 </span></span>
<span><span class="co">#&gt;   --------------------------------------------------</span></span></code></pre></div>
<p>For imputations under a jump to reference assumption, we get an estimated difference of
-4.360 (95% CI -6.238 to -2.482)
between the two groups at the last visit with an associated p-value of
&lt;0.001.</p>
</div>
<div class="section level2" number="5">
<h2 id="imputation-under-mar-with-time-varying-covariates">
<span class="header-section-number">5</span> Imputation under MAR with time-varying covariates<a class="anchor" aria-label="anchor" href="#imputation-under-mar-with-time-varying-covariates"></a>
</h2>
<p><code>rbmi</code> supports the inclusion of time-varying covariates in the imputation model. This is particularly useful for implementing so-called retrieved dropout models.
The vignette “Implementation of retrieved-dropout models using rbmi” (<code><a href="../articles/retrieved_dropout.html">vignette(topic = "retrieved_dropout", package = "rbmi")</a></code>) contains examples of such models.</p>
</div>
<div class="section level2" number="6">
<h2 id="custom-imputation-strategies">
<span class="header-section-number">6</span> Custom imputation strategies<a class="anchor" aria-label="anchor" href="#custom-imputation-strategies"></a>
</h2>
<p>The following imputation strategies are implemented in <code>rbmi</code>:</p>
<ul>
<li>Missing at Random (<code>MAR</code>)</li>
<li>Jump to Reference (<code>JR</code>)</li>
<li>Copy Reference (<code>CR</code>)</li>
<li>Copy Increments in Reference (<code>CIR</code>)</li>
<li>Last Mean Carried Forward (<code>LMCF</code>)</li>
</ul>
<p>In addition, <code>rbmi</code> allows the user to implement their own imputation strategy.
To do this, the user needs to do three things:</p>
<ol style="list-style-type: decimal">
<li>Define a function implementing the new imputation strategy.</li>
<li>Specify which patients use this strategy in the <code>data_ice</code> dataset provided to <code><a href="../reference/draws.html">draws()</a></code>.</li>
<li>Provide the imputation strategy function to <code><a href="../reference/impute.html">impute()</a></code>.</li>
</ol>
<p>The imputation strategy function must take 3 arguments (<code>pars_group</code>, <code>pars_ref</code>, and <code>index_mar</code>) and calculates the mean and covariance matrix of the subject’s marginal imputation distribution which will then be applied to subjects to which the strategy applies.
Here, <code>pars_group</code> contains the predicted mean trajectory (<code>pars_group$mu</code>, a numeric vector) and covariance matrix (<code>pars_group$sigma</code>) for a subject conditional on their assigned treatment group and covariates.
<code>pars_ref</code> contains the corresponding mean trajectory and covariance matrix conditional on the reference group and the subject’s covariates.
<code>index_mar</code> is a logical vector which specifies for each visit whether the visit is unaffected by an ICE handled using a non-MAR method or not.
As an example, the user can check how the CIR strategy was implemented by looking at function <code><a href="../reference/strategies.html">strategy_CIR()</a></code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">strategy_CIR</span></span>
<span><span class="co">#&gt; function (pars_group, pars_ref, index_mar) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     if (all(index_mar)) {</span></span>
<span><span class="co">#&gt;         return(pars_group)</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     else if (all(!index_mar)) {</span></span>
<span><span class="co">#&gt;         return(pars_ref)</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     mu &lt;- pars_group$mu</span></span>
<span><span class="co">#&gt;     last_mar &lt;- which(!index_mar)[1] - 1</span></span>
<span><span class="co">#&gt;     increments_from_last_mar_ref &lt;- pars_ref$mu[!index_mar] - </span></span>
<span><span class="co">#&gt;         pars_ref$mu[last_mar]</span></span>
<span><span class="co">#&gt;     mu[!index_mar] &lt;- mu[last_mar] + increments_from_last_mar_ref</span></span>
<span><span class="co">#&gt;     sigma &lt;- compute_sigma(sigma_group = pars_group$sigma, sigma_ref = pars_ref$sigma, </span></span>
<span><span class="co">#&gt;         index_mar = index_mar)</span></span>
<span><span class="co">#&gt;     pars &lt;- list(mu = mu, sigma = sigma)</span></span>
<span><span class="co">#&gt;     return(pars)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x55ac430889c8&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: namespace:rbmi&gt;</span></span></code></pre></div>
<p>To further illustrate this for a simple example, assume that a new strategy is to be implemented as follows:
- The marginal mean of the imputation distribution is equal to the marginal mean trajectory for the subject according to their assigned group and covariates up to the ICE.
- After the ICE the marginal mean of the imputation distribution is equal to the average of the visit-wise marginal means based on the subjects covariates and the assigned group or the reference group, respectively.
- For the covariance matrix of the marginal imputation distribution, the covariance matrix from the assigned group is taken.</p>
<p>To do this, we first need to define the imputation function which for this example could be coded as follows:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">strategy_AVG</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pars_group</span>, <span class="va">pars_ref</span>, <span class="va">index_mar</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">mu_mean</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">pars_group</span><span class="op">$</span><span class="va">mu</span> <span class="op">+</span> <span class="va">pars_ref</span><span class="op">$</span><span class="va">mu</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">pars_group</span></span>
<span>    <span class="va">x</span><span class="op">$</span><span class="va">mu</span><span class="op">[</span><span class="op">!</span><span class="va">index_mar</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mu_mean</span><span class="op">[</span><span class="op">!</span><span class="va">index_mar</span><span class="op">]</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>And an example showing its use:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pars_group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>    sigma <span class="op">=</span> <span class="fu"><a href="../reference/simulate_test_data.html">as_vcov</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.45</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">pars_ref</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">7</span><span class="op">)</span>,</span>
<span>    sigma <span class="op">=</span> <span class="fu"><a href="../reference/simulate_test_data.html">as_vcov</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">index_mar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">strategy_AVG</span><span class="op">(</span><span class="va">pars_group</span>, <span class="va">pars_ref</span>, <span class="va">index_mar</span><span class="op">)</span></span>
<span><span class="co">#&gt; $mu</span></span>
<span><span class="co">#&gt; [1] 1 2 5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $sigma</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3]</span></span>
<span><span class="co">#&gt; [1,]  1.0  1.2  1.0</span></span>
<span><span class="co">#&gt; [2,]  1.2  9.0  2.7</span></span>
<span><span class="co">#&gt; [3,]  1.0  2.7  4.0</span></span></code></pre></div>
<p>To incorporate this into <code>rbmi</code>, <code>data_ice</code> needs to be updated such that the strategy <code>AVG</code> is specified for visits affected by the ICE. Additionally, the function needs
to be provided to <code><a href="../reference/impute.html">impute()</a></code> via the <code><a href="../reference/getStrategies.html">getStrategies()</a></code> function as shown below:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_ice_AVG</span> <span class="op">&lt;-</span> <span class="va">data_ice_CIR</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>strategy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">strategy</span> <span class="op">==</span> <span class="st">"CIR"</span>, <span class="st">"AVG"</span>, <span class="va">strategy</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">draw_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draws.html">draws</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">data</span>,</span>
<span>    data_ice <span class="op">=</span> <span class="va">data_ice_AVG</span>,</span>
<span>    vars <span class="op">=</span> <span class="va">vars</span>,</span>
<span>    method <span class="op">=</span> <span class="va">method</span>,</span>
<span>    quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">impute_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/impute.html">impute</a></span><span class="op">(</span></span>
<span>    <span class="va">draw_obj</span>,</span>
<span>    references <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Control"</span> <span class="op">=</span> <span class="st">"Control"</span>, <span class="st">"Intervention"</span> <span class="op">=</span> <span class="st">"Control"</span><span class="op">)</span>,</span>
<span>    strategies <span class="op">=</span> <span class="fu"><a href="../reference/getStrategies.html">getStrategies</a></span><span class="op">(</span>AVG <span class="op">=</span> <span class="va">strategy_AVG</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Then, the analysis could proceed by calling <code><a href="../reference/analyse.html">analyse()</a></code> and <code><a href="../reference/pool.html">pool()</a></code> as before.</p>
</div>
<div class="section level2" number="7">
<h2 id="custom-analysis-functions">
<span class="header-section-number">7</span> Custom analysis functions<a class="anchor" aria-label="anchor" href="#custom-analysis-functions"></a>
</h2>
<p>By default <code>rbmi</code> will analyse the data by using the <code><a href="../reference/ancova.html">ancova()</a></code> function.
This analysis function fits an ANCOVA model to the outcomes from each visit separately,
and returns the “treatment effect” estimate as well as the corresponding least square means
for each group. If the user wants to perform a different analysis, or return different
statistics from the analysis, then this can be done by using a custom analysis function.
Beware that the validity of the conditional mean imputation method has only been formally established for analysis functions corresponding to linear models (such as ANCOVA) and caution is
required when applying alternative analysis functions for this method.</p>
<p>The custom analysis function must take a <code>data.frame</code> as its
first argument and return a named <code>list</code> with each element itself being a <code>list</code>
containing at a minimum a point estimate, called <code>est</code>.
For method <code><a href="../reference/method.html">method_bayes()</a></code> or <code><a href="../reference/method.html">method_approxbayes()</a></code>, the list must additionally contain a
standard error (element <code>se</code>) and, if available, the degrees of freedom of the complete-data analysis model (element <code>df</code>).</p>
<p>As a simple example, we replicate the ANCOVA analysis at the last visit for the CIR-based imputations with a user-defined analysis function below:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare_change_lastvisit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">change</span> <span class="op">~</span> <span class="va">group</span> <span class="op">+</span> <span class="va">outcome_bl</span>, data <span class="op">=</span> <span class="va">data</span>, subset <span class="op">=</span> <span class="op">(</span><span class="va">visit</span> <span class="op">==</span> <span class="fl">6</span><span class="op">)</span> <span class="op">)</span></span>
<span>    <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        trt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>            est <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">[</span><span class="st">"groupIntervention"</span><span class="op">]</span>,</span>
<span>            se <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">[</span><span class="st">"groupIntervention"</span>, <span class="st">"groupIntervention"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>            df <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/df.residual.html" class="external-link">df.residual</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">ana_obj_CIR6</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyse.html">analyse</a></span><span class="op">(</span></span>
<span>  <span class="va">impute_obj_CIR</span>,</span>
<span>  fun <span class="op">=</span> <span class="va">compare_change_lastvisit</span>,</span>
<span>  vars <span class="op">=</span> <span class="va">vars_an</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/pool.html">pool</a></span><span class="op">(</span><span class="va">ana_obj_CIR6</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Pool Object</span></span>
<span><span class="co">#&gt; -----------</span></span>
<span><span class="co">#&gt; Number of Results Combined: 20</span></span>
<span><span class="co">#&gt; Method: rubin</span></span>
<span><span class="co">#&gt; Confidence Level: 0.95</span></span>
<span><span class="co">#&gt; Alternative: two.sided</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Results:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   =================================================</span></span>
<span><span class="co">#&gt;    parameter   est     se     lci    uci     pval  </span></span>
<span><span class="co">#&gt;   -------------------------------------------------</span></span>
<span><span class="co">#&gt;       trt     -4.537  0.954  -6.42  -2.655  &lt;0.001 </span></span>
<span><span class="co">#&gt;   -------------------------------------------------</span></span></code></pre></div>
<p>As a second example, assume that for a supplementary analysis the user wants to compare the proportion of subjects with a change from baseline of &gt;10 points at the last
visit between the treatment groups with the baseline outcome as an additional covariate. This could lead to the following basic analysis function:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare_prop_lastvisit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">change</span> <span class="op">&gt;</span> <span class="fl">10</span><span class="op">)</span> <span class="op">~</span> <span class="va">group</span> <span class="op">+</span> <span class="va">outcome_bl</span>,</span>
<span>        family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        data <span class="op">=</span> <span class="va">data</span>,</span>
<span>        subset <span class="op">=</span> <span class="op">(</span><span class="va">visit</span> <span class="op">==</span> <span class="fl">6</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        trt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>            est <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">[</span><span class="st">"groupIntervention"</span><span class="op">]</span>,</span>
<span>            se <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">[</span><span class="st">"groupIntervention"</span>, <span class="st">"groupIntervention"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>            df <span class="op">=</span> <span class="cn">NA</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span>    </span>
<span><span class="va">ana_obj_prop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyse.html">analyse</a></span><span class="op">(</span></span>
<span>  <span class="va">impute_obj_CIR</span>,</span>
<span>  fun <span class="op">=</span> <span class="va">compare_prop_lastvisit</span>,</span>
<span>  vars <span class="op">=</span> <span class="va">vars_an</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">pool_obj_prop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pool.html">pool</a></span><span class="op">(</span><span class="va">ana_obj_prop</span><span class="op">)</span></span>
<span><span class="va">pool_obj_prop</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Pool Object</span></span>
<span><span class="co">#&gt; -----------</span></span>
<span><span class="co">#&gt; Number of Results Combined: 20</span></span>
<span><span class="co">#&gt; Method: rubin</span></span>
<span><span class="co">#&gt; Confidence Level: 0.95</span></span>
<span><span class="co">#&gt; Alternative: two.sided</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Results:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   =================================================</span></span>
<span><span class="co">#&gt;    parameter   est     se     lci     uci    pval  </span></span>
<span><span class="co">#&gt;   -------------------------------------------------</span></span>
<span><span class="co">#&gt;       trt     -1.052  0.314  -1.667  -0.438  0.001 </span></span>
<span><span class="co">#&gt;   -------------------------------------------------</span></span>
<span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">pool_obj_prop</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        OR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span>,</span>
<span>        OR.lci <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">lci</span><span class="op">)</span>,</span>
<span>        OR.uci <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">uci</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">parameter</span>, <span class="va">OR</span>, <span class="va">OR.lci</span>, <span class="va">OR.uci</span><span class="op">)</span></span>
<span><span class="va">tmp</span></span>
<span><span class="co">#&gt;   parameter        OR   OR.lci    OR.uci</span></span>
<span><span class="co">#&gt; 1       trt 0.3491078 0.188807 0.6455073</span></span></code></pre></div>
<p>Note that if the user wants <code>rbmi</code> to use a normal approximation to the pooled test statistics, then the degrees of freedom need to be set to <code>df = NA</code> (as per the above example). If the degrees of freedom of the complete data test statistics are known or if the degrees of freedom are set to <code>df = Inf</code>, then <code>rbmi</code> pools the degrees of freedom across imputed datasets according to the rule by Barnard and Rubin (see the “Statistical Specifications” vignette (<code><a href="../articles/stat_specs.html">vignette("stat_specs", package = "rbmi")</a></code> for details). According to this rule, infinite degrees of freedom for the complete data analysis do not imply that the pooled degrees of freedom are also infinite.
Rather, in this case the pooled degrees of freedom are <code>(M-1)/lambda^2</code>, where <code>M</code> is the number of imputations and <code>lambda</code> is the fraction of missing information (see <span class="citation">Barnard and Rubin (<a href="#ref-Barnard1999">1999</a>)</span> for details).</p>
</div>
<div class="section level2" number="8">
<h2 id="sensitivity-analyses-delta-adjustments-and-tipping-point-analyses">
<span class="header-section-number">8</span> Sensitivity analyses: Delta adjustments and tipping point analyses<a class="anchor" aria-label="anchor" href="#sensitivity-analyses-delta-adjustments-and-tipping-point-analyses"></a>
</h2>
<p>Delta-adjustments are used to impute missing data under a not missing at random (NMAR) assumption. This reflects the belief that unobserved outcomes would have been systematically “worse” (or “better”) than “comparable” observed outcomes. For an extensive discussion of delta-adjustment methods, we refer to <span class="citation">Cro et al. (<a href="#ref-CroEtAlTutorial2020">2020</a>)</span>.</p>
<p>In <code>rbmi</code>, a marginal delta-adjustment approach is implemented. This means that the delta-adjustment is applied to the dataset after data imputation under MAR or reference-based missing data assumptions and prior to the analysis of the imputed data.
Sensitivity analysis using delta-adjustments can therefore be performed without having to re-fit the imputation model. In <code>rbmi</code>, they are implemented via the <code>delta</code> argument of the <code><a href="../reference/analyse.html">analyse()</a></code> function.</p>
<div class="section level3" number="8.1">
<h3 id="simple-delta-adjustments-and-tipping-point-analyses">
<span class="header-section-number">8.1</span> Simple delta adjustments and tipping point analyses<a class="anchor" aria-label="anchor" href="#simple-delta-adjustments-and-tipping-point-analyses"></a>
</h3>
<p>The <code>delta</code> argument of <code><a href="../reference/analyse.html">analyse()</a></code> allows users to modify the outcome variable prior to the analysis.
To do this, the user needs to provide a <code>data.frame</code> which contains columns for the subject and visit (to identify the observation to be adjusted) plus an additional column called <code>delta</code> which specifies the value which will be added to the outcomes prior to the analysis.</p>
<p>The <code><a href="../reference/delta_template.html">delta_template()</a></code> function supports the user in creating this <code>data.frame</code>: it creates a skeleton <code>data.frame</code> containing one row per subject and visit with the value of <code>delta</code> set to 0 for all observations:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat_delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/delta_template.html">delta_template</a></span><span class="op">(</span>imputations <span class="op">=</span> <span class="va">impute_obj_CIR</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat_delta</span><span class="op">)</span></span>
<span><span class="co">#&gt;     id visit   group is_mar is_missing is_post_ice strategy delta</span></span>
<span><span class="co">#&gt; 1 id_1     1 Control   TRUE       TRUE        TRUE      MAR     0</span></span>
<span><span class="co">#&gt; 2 id_1     2 Control   TRUE       TRUE        TRUE      MAR     0</span></span>
<span><span class="co">#&gt; 3 id_1     3 Control   TRUE       TRUE        TRUE      MAR     0</span></span>
<span><span class="co">#&gt; 4 id_1     4 Control   TRUE       TRUE        TRUE      MAR     0</span></span>
<span><span class="co">#&gt; 5 id_1     5 Control   TRUE       TRUE        TRUE      MAR     0</span></span>
<span><span class="co">#&gt; 6 id_1     6 Control   TRUE       TRUE        TRUE      MAR     0</span></span></code></pre></div>
<p>Note that the output of <code><a href="../reference/delta_template.html">delta_template()</a></code> contains additional information which can be used to properly re-set variable <code>delta</code>.</p>
<p>For example, assume that the user wants to implement a delta-adjustment to the imputed values under CIR described in section <a href="#sec:postICEobs">3</a>.<br>
Specifically, assume that a fixed “worsening adjustment” of +5 points is applied to all imputed values regardless of the treatment group. This could be programmed as follows:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set delta-value to 5 for all imputed (previously missing) outcomes and 0 for all other outcomes</span></span>
<span><span class="va">dat_delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/delta_template.html">delta_template</a></span><span class="op">(</span>imputations <span class="op">=</span> <span class="va">impute_obj_CIR</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>delta <span class="op">=</span> <span class="va">is_missing</span> <span class="op">*</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Repeat the analyses with the delta-adjusted values and pool results</span></span>
<span><span class="va">ana_delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyse.html">analyse</a></span><span class="op">(</span></span>
<span>    <span class="va">impute_obj_CIR</span>,</span>
<span>    delta <span class="op">=</span> <span class="va">dat_delta</span>,</span>
<span>    vars <span class="op">=</span> <span class="va">vars_an</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/pool.html">pool</a></span><span class="op">(</span><span class="va">ana_delta</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Pool Object</span></span>
<span><span class="co">#&gt; -----------</span></span>
<span><span class="co">#&gt; Number of Results Combined: 20</span></span>
<span><span class="co">#&gt; Method: rubin</span></span>
<span><span class="co">#&gt; Confidence Level: 0.95</span></span>
<span><span class="co">#&gt; Alternative: two.sided</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Results:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   ==================================================</span></span>
<span><span class="co">#&gt;    parameter   est     se     lci     uci     pval  </span></span>
<span><span class="co">#&gt;   --------------------------------------------------</span></span>
<span><span class="co">#&gt;      trt_1    -0.482  0.524  -1.516  0.552   0.359  </span></span>
<span><span class="co">#&gt;    lsm_ref_1  2.718   0.37   1.987   3.448   &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_alt_1  2.235   0.37   1.505   2.966   &lt;0.001 </span></span>
<span><span class="co">#&gt;      trt_2    -0.016  0.56   -1.12   1.089   0.978  </span></span>
<span><span class="co">#&gt;    lsm_ref_2  3.907   0.396  3.125   4.688   &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_alt_2  3.891   0.395  3.111   4.671   &lt;0.001 </span></span>
<span><span class="co">#&gt;      trt_3    -1.684  0.641  -2.948  -0.42   0.009  </span></span>
<span><span class="co">#&gt;    lsm_ref_3  6.092   0.452  5.201   6.983   &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_alt_3  4.408   0.452  3.515    5.3    &lt;0.001 </span></span>
<span><span class="co">#&gt;      trt_4    -2.359  0.741  -3.821  -0.897  0.002  </span></span>
<span><span class="co">#&gt;    lsm_ref_4  7.951   0.526  6.913    8.99   &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_alt_4  5.593   0.522  4.563   6.623   &lt;0.001 </span></span>
<span><span class="co">#&gt;      trt_5    -3.34   0.919  -5.153  -1.526  &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_ref_5  9.899   0.643  8.631   11.168  &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_alt_5  6.559   0.653  5.271   7.848   &lt;0.001 </span></span>
<span><span class="co">#&gt;      trt_6    -4.21   1.026  -6.236  -2.184  &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_ref_6  11.435  0.718  10.019  12.851  &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_alt_6  7.225   0.725  5.793   8.656   &lt;0.001 </span></span>
<span><span class="co">#&gt;   --------------------------------------------------</span></span></code></pre></div>
<p>The same approach can be used to implement a tipping point analysis. Here, we apply different delta-adjustments to imputed data from the control and the intervention group, respectively. Assume that delta-adjustments by less then -5 points or by more than +15 points are considered implausible from a clinical perspective. Therefore, we vary the delta-values in each group between -5 to +15 points to investigate which delta combinations lead to a “tipping” of the primary analysis result, defined here as an analysis p-value <span class="math inline">\(\geq 0.05\)</span>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">perform_tipp_analysis</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">delta_control</span>, <span class="va">delta_intervention</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>    <span class="co"># Derive delta offset based on control and intervention specific deltas    </span></span>
<span>    <span class="va">delta_df</span> <span class="op">&lt;-</span>  <span class="va">delta_df_init</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>            delta_ctl <span class="op">=</span> <span class="op">(</span><span class="va">group</span> <span class="op">==</span> <span class="st">"Control"</span><span class="op">)</span> <span class="op">*</span> <span class="va">is_missing</span> <span class="op">*</span> <span class="va">delta_control</span>,</span>
<span>            delta_int <span class="op">=</span> <span class="op">(</span><span class="va">group</span> <span class="op">==</span> <span class="st">"Intervention"</span><span class="op">)</span> <span class="op">*</span> <span class="va">is_missing</span> <span class="op">*</span> <span class="va">delta_intervention</span>,</span>
<span>            delta <span class="op">=</span> <span class="va">delta_ctl</span> <span class="op">+</span> <span class="va">delta_int</span></span>
<span>        <span class="op">)</span></span>
<span></span>
<span>    <span class="va">ana_delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyse.html">analyse</a></span><span class="op">(</span></span>
<span>        <span class="va">impute_obj_CIR</span>,</span>
<span>        fun <span class="op">=</span> <span class="va">compare_change_lastvisit</span>,</span>
<span>        vars <span class="op">=</span> <span class="va">vars_an</span>,</span>
<span>        delta <span class="op">=</span> <span class="va">delta_df</span>,</span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="va">pool_delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="../reference/pool.html">pool</a></span><span class="op">(</span><span class="va">ana_delta</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        trt_effect_6 <span class="op">=</span> <span class="va">pool_delta</span><span class="op">[[</span><span class="st">"est"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>        pval_6 <span class="op">=</span> <span class="va">pool_delta</span><span class="op">[[</span><span class="st">"pval"</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Get initial delta template</span></span>
<span><span class="va">delta_df_init</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/delta_template.html">delta_template</a></span><span class="op">(</span><span class="va">impute_obj_CIR</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tipp_frame_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span>
<span>    delta_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">15</span>, by <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>    delta_intervention <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">15</span>, by <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">tipp_frame</span> <span class="op">&lt;-</span> <span class="va">tipp_frame_grid</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        results_list <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2</a></span><span class="op">(</span><span class="va">delta_control</span>, <span class="va">delta_intervention</span>, <span class="va">perform_tipp_analysis</span><span class="op">)</span>,</span>
<span>        trt_effect_6 <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl</a></span><span class="op">(</span><span class="va">results_list</span>, <span class="st">"trt_effect_6"</span><span class="op">)</span>,</span>
<span>        pval_6 <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl</a></span><span class="op">(</span><span class="va">results_list</span>, <span class="st">"pval_6"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">results_list</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        pval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span></span>
<span>            <span class="va">pval_6</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.2</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>            right <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&lt;0.001"</span>, <span class="st">"0.001 - &lt;0.01"</span>, <span class="st">"0.01- &lt;0.05"</span>, <span class="st">"0.05 - &lt;0.20"</span>, <span class="st">"&gt;= 0.20"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co"># Show delta values which lead to non-significant analysis results</span></span>
<span><span class="va">tipp_frame</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">pval_6</span> <span class="op">&gt;=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 5</span></span></span>
<span><span class="co">#&gt;   delta_control delta_intervention trt_effect_6 pval_6 pval        </span></span>
<span><span class="co">#&gt;           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>            -<span style="color: #BB0000;">5</span>                 15        -<span style="color: #BB0000;">1.99</span> 0.093<span style="text-decoration: underline;">5</span> 0.05 - &lt;0.20</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>            -<span style="color: #BB0000;">3</span>                 15        -<span style="color: #BB0000;">2.15</span> 0.070<span style="text-decoration: underline;">4</span> 0.05 - &lt;0.20</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>            -<span style="color: #BB0000;">1</span>                 15        -<span style="color: #BB0000;">2.31</span> 0.052<span style="text-decoration: underline;">7</span> 0.05 - &lt;0.20</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">tipp_frame</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">delta_control</span>, <span class="va">delta_intervention</span>, fill <span class="op">=</span> <span class="va">pval</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"darkgreen"</span>, <span class="st">"lightgreen"</span>, <span class="st">"lightyellow"</span>, <span class="st">"orange"</span>, <span class="st">"red"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_files/figure-html/unnamed-chunk-15-1.png"><!-- --></p>
<p>According to this analysis, the significant test result from the primary analysis under CIR could only be tipped to a non-significant result for rather extreme delta-adjustments. Please note that for a real analysis it is recommended to use a smaller step size in the grid than what has been used here.</p>
</div>
<div class="section level3" number="8.2">
<h3 id="more-flexible-delta-adjustments-using-the-dlag-and-delta-arguments-of-delta_template">
<span class="header-section-number">8.2</span> More flexible delta-adjustments using the <code>dlag</code> and <code>delta</code> arguments of <code>delta_template()</code><a class="anchor" aria-label="anchor" href="#more-flexible-delta-adjustments-using-the-dlag-and-delta-arguments-of-delta_template"></a>
</h3>
<p>So far, we have only discussed simple <code>delta</code> arguments which add the same value to all imputed values.
However, the user may want to apply more flexible delta-adjustments to missing values after an intercurrent event (ICE) and vary the magnitude of the delta adjustment depending on the how far away the visit in question is from the ICE visit.</p>
<p>To facilitate the creation of such flexible delta-adjustments, the <code><a href="../reference/delta_template.html">delta_template()</a></code> function has two optional additional arguments <code>delta</code>
and <code>dlag</code>. The <code>delta</code> argument specifies the default amount of delta
that should be applied to each post-ICE visit, whilst
<code>dlag</code> specifies the scaling coefficient to be applied based upon the visits proximity
to the first visit affected by the ICE. By default, the delta will only be added to unobserved (i.e. imputed) post-ICE
outcomes but this can be changed by setting the optional argument <code>missing_only = FALSE</code>.</p>
<p>The usage of the <code>delta</code> and <code>dlag</code> arguments is best illustrated with a few examples:</p>
<p>Assume a setting with 4 visits and that the user specified <code>delta = c(5,6,7,8)</code> and <code>dlag=c(1,2,3,4)</code>.</p>
<p>For a subject for whom the first visit affected by the ICE is visit 2, these values of <code>delta</code> and <code>dlag</code> would imply the following delta offset:</p>
<pre><code>v1  v2  v3  v4
--------------
 5   6   7   8  # delta assigned to each visit
 0   1   2   3  # scaling starting from the first visit after the subjects ICE
--------------
 0   6  14  24  # delta * scaling
--------------
 0   6  20  44  # cumulative sum (i.e. delta) to be applied to each visit</code></pre>
<p>That is, the subject would have a delta offset of 0 applied to visit v1, 6 for visit v2, 20 for visit v3 and 44 for visit v4.</p>
<p>Assume instead, that the subject’s first visit affected by the ICE was visit 3. Then, the above values of <code>delta</code> and <code>dlag</code> would imply the following delta offset:</p>
<pre><code>v1  v2  v3  v4
--------------
 5   6   7   8  # delta assigned to each visit
 0   0   1   2  # scaling starting from the first visit after the subjects ICE
--------------
 0   0   7  16  # delta * scaling
--------------
 0   0   7  23  # cumulative sum (i.e. delta) to be applied to each visit</code></pre>
<p>To apply a constant delta value of +5 to all visits affected by the ICE
regardless of their proximity to the first ICE visit, one could set <code>delta = c(5,5,5,5)</code> and <code>dlag = c(1,0,0,0)</code>.
Alternatively, it may be more straightforward for this setting to call the <code><a href="../reference/delta_template.html">delta_template()</a></code> function without the <code>delta</code> and <code>dlag</code> arguments and then overwrite the <code>delta</code> column of the resulting <code>data.frame</code> as described in the previous section (and additionally relying on the <code>is_post_ice</code> variable).</p>
<p>Another way of using these arguments is to set <code>delta</code> to the difference in time
between visits and dlag to be the amount of delta per unit of time. For example,
let’s say that visits occur on weeks 1, 5, 6 and 9 and that we want a delta of 3
to be applied for each week after an ICE.
For simplicity, we assume that the ICE occurs immediately after the subject’s last visit which
is not affected by the ICE. This this could be achieved by setting
<code>delta = c(1,4,1,3)</code> (the difference in weeks between each visit) and <code>dlag = c(3, 3, 3, 3)</code>.</p>
<p>Assume a subject’s first visit affected by the ICE was visit v2, then these values of <code>delta</code> and <code>dlag</code> would imply the following delta offsets:</p>
<pre><code>v1  v2  v3  v4
--------------
 1   4   1   3  # delta assigned to each visit
 0   3   3   3  # scaling starting from the first visit after the subjects ICE
--------------
 0  12   3   9  # delta * scaling
--------------
 0  12  15  24  # cumulative sum (i.e. delta) to be applied to each visit</code></pre>
<p>To wrap up, we show this in action for our simulated dataset from section <a href="#sec:dataSimul">2</a> and the imputed datasets
based on a CIR assumption from section <a href="#sec:postICEobs">3</a>.
The simulation setting specified follow-up visits at months 2, 4, 6, 8, 10, and 12.<br>
Assume that we want to apply a delta-adjustment of 1 for every month after an ICE to unobserved post-ICE visits from the intervention group only. (E.g. if the ICE occurred immediately after the month 4 visit, then the total delta applied to a missing value from the month 10 visit would be 6.)</p>
<p>To program this, we first use the <code>delta</code> and <code>dlag</code> arguments of <code><a href="../reference/delta_template.html">delta_template()</a></code> to set up a corresponding template <code>data.frame</code>:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">delta_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/delta_template.html">delta_template</a></span><span class="op">(</span></span>
<span>    <span class="va">impute_obj_CIR</span>,</span>
<span>    delta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    dlag <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">delta_df</span><span class="op">)</span></span>
<span><span class="co">#&gt;     id visit   group is_mar is_missing is_post_ice strategy delta</span></span>
<span><span class="co">#&gt; 1 id_1     1 Control   TRUE       TRUE        TRUE      MAR     2</span></span>
<span><span class="co">#&gt; 2 id_1     2 Control   TRUE       TRUE        TRUE      MAR     4</span></span>
<span><span class="co">#&gt; 3 id_1     3 Control   TRUE       TRUE        TRUE      MAR     6</span></span>
<span><span class="co">#&gt; 4 id_1     4 Control   TRUE       TRUE        TRUE      MAR     8</span></span>
<span><span class="co">#&gt; 5 id_1     5 Control   TRUE       TRUE        TRUE      MAR    10</span></span>
<span><span class="co">#&gt; 6 id_1     6 Control   TRUE       TRUE        TRUE      MAR    12</span></span></code></pre></div>
<p>Next, we can use the additional metadata variables provided by <code><a href="../reference/delta_template.html">delta_template()</a></code> to manually
reset the delta values for the control group back to 0:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">delta_df2</span> <span class="op">&lt;-</span> <span class="va">delta_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>delta <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">group</span> <span class="op">==</span> <span class="st">"Control"</span>, <span class="fl">0</span>, <span class="va">delta</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">delta_df2</span><span class="op">)</span></span>
<span><span class="co">#&gt;     id visit   group is_mar is_missing is_post_ice strategy delta</span></span>
<span><span class="co">#&gt; 1 id_1     1 Control   TRUE       TRUE        TRUE      MAR     0</span></span>
<span><span class="co">#&gt; 2 id_1     2 Control   TRUE       TRUE        TRUE      MAR     0</span></span>
<span><span class="co">#&gt; 3 id_1     3 Control   TRUE       TRUE        TRUE      MAR     0</span></span>
<span><span class="co">#&gt; 4 id_1     4 Control   TRUE       TRUE        TRUE      MAR     0</span></span>
<span><span class="co">#&gt; 5 id_1     5 Control   TRUE       TRUE        TRUE      MAR     0</span></span>
<span><span class="co">#&gt; 6 id_1     6 Control   TRUE       TRUE        TRUE      MAR     0</span></span></code></pre></div>
<p>Finally, we can use our delta <code>data.frame</code> to apply the desired delta offset to our analysis:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ana_delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyse.html">analyse</a></span><span class="op">(</span><span class="va">impute_obj_CIR</span>, delta <span class="op">=</span> <span class="va">delta_df2</span>, vars <span class="op">=</span> <span class="va">vars_an</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/pool.html">pool</a></span><span class="op">(</span><span class="va">ana_delta</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Pool Object</span></span>
<span><span class="co">#&gt; -----------</span></span>
<span><span class="co">#&gt; Number of Results Combined: 20</span></span>
<span><span class="co">#&gt; Method: rubin</span></span>
<span><span class="co">#&gt; Confidence Level: 0.95</span></span>
<span><span class="co">#&gt; Alternative: two.sided</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Results:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   ==================================================</span></span>
<span><span class="co">#&gt;    parameter   est     se     lci     uci     pval  </span></span>
<span><span class="co">#&gt;   --------------------------------------------------</span></span>
<span><span class="co">#&gt;      trt_1    -0.446  0.514  -1.459  0.567   0.386  </span></span>
<span><span class="co">#&gt;    lsm_ref_1   2.62   0.363  1.904   3.335   &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_alt_1  2.173   0.363  1.458   2.889   &lt;0.001 </span></span>
<span><span class="co">#&gt;      trt_2    0.072   0.546  -1.006   1.15   0.895  </span></span>
<span><span class="co">#&gt;    lsm_ref_2  3.708   0.387  2.945   4.471   &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_alt_2   3.78   0.386  3.018   4.542   &lt;0.001 </span></span>
<span><span class="co">#&gt;      trt_3    -1.507  0.626  -2.743  -0.272  0.017  </span></span>
<span><span class="co">#&gt;    lsm_ref_3  5.844   0.441  4.973   6.714   &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_alt_3  4.336   0.442  3.464   5.209   &lt;0.001 </span></span>
<span><span class="co">#&gt;      trt_4    -2.062  0.731  -3.504  -0.621  0.005  </span></span>
<span><span class="co">#&gt;    lsm_ref_4  7.658   0.519  6.634   8.682   &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_alt_4  5.596   0.515   4.58   6.612   &lt;0.001 </span></span>
<span><span class="co">#&gt;      trt_5    -2.938  0.916  -4.746  -1.13   0.002  </span></span>
<span><span class="co">#&gt;    lsm_ref_5  9.558   0.641  8.293   10.823  &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_alt_5   6.62   0.651  5.335   7.905   &lt;0.001 </span></span>
<span><span class="co">#&gt;      trt_6    -3.53   1.045  -5.591  -1.469  0.001  </span></span>
<span><span class="co">#&gt;    lsm_ref_6  11.045  0.73   9.604   12.486  &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_alt_6  7.515   0.738  6.058   8.971   &lt;0.001 </span></span>
<span><span class="co">#&gt;   --------------------------------------------------</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Barnard1999" class="csl-entry">
Barnard, John, and Donald B Rubin. 1999. <span>“Miscellanea. Small-Sample Degrees of Freedom with Multiple Imputation.”</span> <em>Biometrika</em> 86 (4): 948–55.
</div>
<div id="ref-CroEtAlTutorial2020" class="csl-entry">
Cro, Suzie, Tim P Morris, Michael G Kenward, and James R Carpenter. 2020. <span>“Sensitivity Analysis for Clinical Trials with Missing Continuous Outcome Data Using Controlled Multiple Imputation: A Practical Guide.”</span> <em>Statistics in Medicine</em> 39 (21): 2815–42.
</div>
<div id="ref-Wolbers2021" class="csl-entry">
Wolbers, Marcel, Alessandro Noci, Paul Delmar, Craig Gower-Page, Sean Yiu, and Jonathan W Bartlett. 2022. <span>“Standard and Reference-Based Conditional Mean Imputation.”</span> <em>Pharmaceutical Statistics</em> 21 (6): 1246–57.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Craig Gower-Page, Alessandro Noci, F. Hoffmann-La Roche AG.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
