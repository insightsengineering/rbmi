<!DOCTYPE html>
<!-- Generated by pkgdown + https://github.com/insightsengineering/r-pkgdown-multiversion -->
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>rbmi: Inference with Conditional Mean Imputation • rbmi</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="rbmi: Inference with Conditional Mean Imputation">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rbmi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.5.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/quickstart.html">rbmi: Quickstart</a></li>
    <li><a class="dropdown-item" href="../articles/stat_specs.html">rbmi: Statistical Specifications</a></li>
    <li><a class="dropdown-item" href="../articles/advanced.html">rbmi: Advanced Functionality</a></li>
    <li><a class="dropdown-item" href="../articles/retrieved_dropout.html">rbmi: Implementation of retrieved-dropout models using rbmi</a></li>
    <li><a class="dropdown-item" href="../articles/CondMean_Inference.html">rbmi: Inference with Conditional Mean Imputation</a></li>
    <li><a class="dropdown-item" href="../articles/FAQ.html">rbmi: Frequently Asked Questions</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      <div><li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-versions">Versions</a>
    <div class="dropdown-menu" aria-labelledby="dropdown-versions">
    <a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rbmi/main">main</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rbmi/latest-tag">latest-tag</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rbmi/v1.4.1">v1.4.1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rbmi/v1.4.0">v1.4.0</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rbmi/v1.3.1">v1.3.1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rbmi/v1.3.0">v1.3.0</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/rbmi/v1.2.6">v1.2.6</a>
</div>
</li></div>
</ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/insightsengineering/rbmi/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>rbmi: Inference with Conditional Mean Imputation</h1>
                        <h4 data-toc-skip class="author">Alessandro Noci, Marcel Wolbers, Craig Gower-Page</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/insightsengineering/rbmi/blob/main/vignettes/CondMean_Inference.Rmd" class="external-link"><code>vignettes/CondMean_Inference.Rmd</code></a></small>
      <div class="d-none name"><code>CondMean_Inference.Rmd</code></div>
    </div>

    
    
<div class="section level2" number="1">
<h2 id="introduction">
<span class="header-section-number">1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>As described in section 3.10.2 of the statistical specifications of the package (<code><a href="../articles/stat_specs.html">vignette(topic = "stat_specs", package = "rbmi")</a></code>), two different types of variance estimators have been proposed for reference-based imputation methods in the statistical literature (<span class="citation">Bartlett (<a href="#ref-Bartlett2021">2023</a>)</span>).
The first is the frequentist variance which describes the actual repeated sampling variability of the estimator and results in inference which is correct in the frequentist sense, i.e. hypothesis tests have accurate type I error control and confidence intervals have correct coverage probabilities under repeated sampling if the reference-based assumption is correctly specified (<span class="citation">Bartlett (<a href="#ref-Bartlett2021">2023</a>)</span>, <span class="citation">Wolbers et al. (<a href="#ref-Wolbers2021">2022</a>)</span>).
Reference-based missing data assumption are strong and borrow information from the control arm for imputation in the active arm.
As a consequence, the size of frequentist standard errors for treatment effects may decrease with increasing amounts of missing data.
The second is the so-called “information-anchored” variance which was originally proposed in the context of sensitivity analyses (<span class="citation">Cro, Carpenter, and Kenward (<a href="#ref-CroEtAl2019">2019</a>)</span>). This variance estimator is based on disentangling point estimation and variance estimation altogether.
The resulting information-anchored variance is typically very similar to the variance under missing-at-random (MAR) imputation and increases with increasing amounts of missing data at approximately the same rate as MAR imputation.
However, the information-anchored variance does not reflect the actual variability of the reference-based estimator and the resulting frequentist inference is highly conservative resulting in a substantial power loss.</p>
<p>Reference-based conditional mean imputation combined with a resampling method such as the jackknife or the bootstrap was first introduced in <span class="citation">Wolbers et al. (<a href="#ref-Wolbers2021">2022</a>)</span>.
This approach naturally targets the frequentist variance. The information-anchored variance is typically estimated using Rubin’s rules for Bayesian multiple imputation which are not applicable within the conditional mean imputation framework.
However, an alternative information-anchored variance proposed by <span class="citation">Lu (<a href="#ref-Lu2021">2021</a>)</span> can easily be obtained as we show below.
The basic idea of <span class="citation">Lu (<a href="#ref-Lu2021">2021</a>)</span> is to obtain the information-anchored variance via a MAR imputation combined with a delta-adjustment where delta is selected in a data-driven way to match the reference-based estimator.
For conditional mean imputation, the proposal by <span class="citation">Lu (<a href="#ref-Lu2021">2021</a>)</span> can be implemented by choosing the delta-adjustment as the difference between the conditional mean imputation under the chosen reference-based assumption and MAR on the original dataset.
The variance can then be obtained via the jackknife or the bootstrap while keeping the delta-adjustment fixed. The resulting variance estimate is very similar to Rubin’s variance.
Moreover, as shown in <span class="citation">Cro, Carpenter, and Kenward (<a href="#ref-CroEtAl2019">2019</a>)</span>, the variance of MAR-imputation combined with a delta-adjustment achieves even better information-anchoring properties than Rubin’s variance for reference-based imputation.
Reference-based missing data assumptions are strong and borrow information from the control arm for imputation in the active arm.</p>
<p>This vignette demonstrates first how to obtain frequentist inference using reference-based conditional mean imputation using <code>rbmi</code>, and then shows that an information-anchored inference can also be easily implemented using the package.</p>
</div>
<div class="section level2" number="2">
<h2 id="data-and-model-specification">
<span class="header-section-number">2</span> Data and model specification<a class="anchor" aria-label="anchor" href="#data-and-model-specification"></a>
</h2>
<p>We use a publicly available example dataset from an antidepressant clinical trial of an active drug versus placebo.
The relevant endpoint is the Hamilton 17-item depression rating scale (HAMD17) which was assessed at baseline and at weeks 1, 2, 4, and 6.
Study drug discontinuation occurred in 24% of subjects from the active drug and 26% of subjects from placebo.
All data after study drug discontinuation are missing and there is a single additional intermittent missing observation.</p>
<p>We consider an imputation model with the mean change from baseline in the HAMD17 score as the outcome (variable CHANGE in the dataset).
The following covariates are included in the imputation model: the treatment group (THERAPY), the (categorical) visit (VISIT), treatment-by-visit interactions, the baseline HAMD17 score (BASVAL), and baseline HAMD17 score-by-visit interactions.
A common unstructured covariance matrix structure is assumed for both groups. The analysis model is an ANCOVA model with the treatment group as the primary factor and adjustment for the baseline HAMD17 score.
For this example, we assume that the imputation strategy after the ICE “study-drug discontinuation” is Jump To Reference (JR) for all subjects and the imputation is based on conditional mean imputation combined with jackknife resampling (but the bootstrap could also have been selected).</p>
</div>
<div class="section level2" number="3">
<h2 id="reference-based-conditional-mean-imputation---frequentist-inference">
<span class="header-section-number">3</span> Reference-based conditional mean imputation - frequentist inference<a class="anchor" aria-label="anchor" href="#reference-based-conditional-mean-imputation---frequentist-inference"></a>
</h2>
<p>Conditional mean imputation combined with a resampling method such as jackknife or bootstrap naturally targets a frequentist estimation of the standard error of the treatment effect, thus providing a valid frequentist inference.
Here we provide the code to obtain frequentist inference for reference-based conditional mean imputation using <code>rbmi</code>.</p>
<p>The code used in this section is almost identical to the code in the quickstart vignette (<code><a href="../articles/quickstart.html">vignette(topic = "quickstart", package = "rbmi")</a></code>) except that we use conditional mean imputation combined with the jackknife (<code>method_condmean(type = "jackknife")</code>) here rather than Bayesian multiple imputation (<code><a href="../reference/method.html">method_bayes()</a></code>).
We therefore refer to that vignette and the help files for the individual functions for further explanations and details.</p>
<div class="section level3" number="3.1">
<h3 id="draws">
<span class="header-section-number">3.1</span> Draws<a class="anchor" aria-label="anchor" href="#draws"></a>
</h3>
<p>We will make use of <code><a href="../reference/expand.html">rbmi::expand_locf()</a></code> to expand the dataset in order to have one row per subject per visit with missing outcomes denoted as <code>NA</code>. We will then construct the <code>data_ice</code>, <code>vars</code> and <code>method</code> input arguments to the first core <code>rbmi</code> function, <code><a href="../reference/draws.html">draws()</a></code>.
Finally, we call the function <code><a href="../reference/draws.html">draws()</a></code> to derive the parameter estimates of the base imputation model for the full dataset and all leave-one-subject-out samples.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://insightsengineering.github.io/rbmi/">rbmi</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">antidepressant_data</span></span>
<span></span>
<span><span class="co"># Use expand_locf to add rows corresponding to visits with missing outcomes to</span></span>
<span><span class="co"># the dataset</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/expand.html">expand_locf</a></span><span class="op">(</span></span>
<span>  <span class="va">dat</span>,</span>
<span>  PATIENT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">PATIENT</span><span class="op">)</span>, <span class="co"># expand by PATIENT and VISIT </span></span>
<span>  VISIT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">VISIT</span><span class="op">)</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BASVAL"</span>, <span class="st">"THERAPY"</span><span class="op">)</span>, <span class="co"># fill with LOCF BASVAL and THERAPY</span></span>
<span>  group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PATIENT"</span><span class="op">)</span>,</span>
<span>  order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PATIENT"</span>, <span class="st">"VISIT"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create data_ice and set the imputation strategy to JR for</span></span>
<span><span class="co"># each patient with at least one missing observation</span></span>
<span><span class="va">dat_ice</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">PATIENT</span>, <span class="va">VISIT</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">CHANGE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">PATIENT</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">PATIENT</span>, <span class="va">VISIT</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>strategy <span class="op">=</span> <span class="st">"JR"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># In this dataset, subject 3618 has an intermittent missing values which</span></span>
<span><span class="co"># does not correspond to a study drug discontinuation. We therefore remove</span></span>
<span><span class="co"># this subject from `dat_ice`. (In the later imputation step, it will</span></span>
<span><span class="co"># automatically be imputed under the default MAR assumption.)</span></span>
<span><span class="va">dat_ice</span> <span class="op">&lt;-</span> <span class="va">dat_ice</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">dat_ice</span><span class="op">$</span><span class="va">PATIENT</span> <span class="op">==</span> <span class="fl">3618</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># Define the names of key variables in our dataset and</span></span>
<span><span class="co"># the covariates included in the imputation model using `set_vars()`</span></span>
<span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_vars.html">set_vars</a></span><span class="op">(</span></span>
<span>  outcome <span class="op">=</span> <span class="st">"CHANGE"</span>,</span>
<span>  visit <span class="op">=</span> <span class="st">"VISIT"</span>,</span>
<span>  subjid <span class="op">=</span> <span class="st">"PATIENT"</span>,</span>
<span>  group <span class="op">=</span> <span class="st">"THERAPY"</span>,</span>
<span>  covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BASVAL*VISIT"</span>, <span class="st">"THERAPY*VISIT"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define which imputation method to use (here: conditional mean imputation</span></span>
<span><span class="co"># with jackknife as resampling) </span></span>
<span><span class="va">method</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/method.html">method_condmean</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"jackknife"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create samples for the imputation parameters by running the draws() function</span></span>
<span><span class="va">drawObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draws.html">draws</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">dat</span>,</span>
<span>  data_ice <span class="op">=</span> <span class="va">dat_ice</span>,</span>
<span>  vars <span class="op">=</span> <span class="va">vars</span>,</span>
<span>  method <span class="op">=</span> <span class="va">method</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">drawObj</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Draws Object</span></span>
<span><span class="co">#&gt; ------------</span></span>
<span><span class="co">#&gt; Number of Samples: 1 + 172</span></span>
<span><span class="co">#&gt; Number of Failed Samples: 0</span></span>
<span><span class="co">#&gt; Model Formula: CHANGE ~ 1 + THERAPY + VISIT + BASVAL * VISIT + THERAPY * VISIT</span></span>
<span><span class="co">#&gt; Imputation Type: condmean</span></span>
<span><span class="co">#&gt; Method:</span></span>
<span><span class="co">#&gt;     name: Conditional Mean</span></span>
<span><span class="co">#&gt;     covariance: us</span></span>
<span><span class="co">#&gt;     threshold: 0.01</span></span>
<span><span class="co">#&gt;     same_cov: TRUE</span></span>
<span><span class="co">#&gt;     REML: TRUE</span></span>
<span><span class="co">#&gt;     type: jackknife</span></span></code></pre></div>
</div>
<div class="section level3" number="3.2">
<h3 id="impute">
<span class="header-section-number">3.2</span> Impute<a class="anchor" aria-label="anchor" href="#impute"></a>
</h3>
<p>We can use now the function <code><a href="../reference/impute.html">impute()</a></code> to perform the imputation of the original dataset and of each leave-one-out samples using the results obtained at the previous step.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">references</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DRUG"</span> <span class="op">=</span> <span class="st">"PLACEBO"</span>, <span class="st">"PLACEBO"</span> <span class="op">=</span> <span class="st">"PLACEBO"</span><span class="op">)</span></span>
<span><span class="va">imputeObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/impute.html">impute</a></span><span class="op">(</span><span class="va">drawObj</span>, <span class="va">references</span><span class="op">)</span></span>
<span><span class="va">imputeObj</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Imputation Object</span></span>
<span><span class="co">#&gt; -----------------</span></span>
<span><span class="co">#&gt; Number of Imputed Datasets: 1 + 172</span></span>
<span><span class="co">#&gt; Fraction of Missing Data (Original Dataset):</span></span>
<span><span class="co">#&gt;     4:   0%</span></span>
<span><span class="co">#&gt;     5:   8%</span></span>
<span><span class="co">#&gt;     6:  13%</span></span>
<span><span class="co">#&gt;     7:  25%</span></span>
<span><span class="co">#&gt; References:</span></span>
<span><span class="co">#&gt;     DRUG    -&gt; PLACEBO</span></span>
<span><span class="co">#&gt;     PLACEBO -&gt; PLACEBO</span></span></code></pre></div>
</div>
<div class="section level3" number="3.3">
<h3 id="analyse">
<span class="header-section-number">3.3</span> Analyse<a class="anchor" aria-label="anchor" href="#analyse"></a>
</h3>
<p>Once the datasets have been imputed, we can call the <code><a href="../reference/analyse.html">analyse()</a></code> function to apply the complete-data analysis model (here ANCOVA) to each imputed dataset.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Set analysis variables using `rbmi` function "set_vars"</span></span>
<span><span class="va">vars_an</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_vars.html">set_vars</a></span><span class="op">(</span></span>
<span>  group <span class="op">=</span> <span class="va">vars</span><span class="op">$</span><span class="va">group</span>,</span>
<span>  visit <span class="op">=</span> <span class="va">vars</span><span class="op">$</span><span class="va">visit</span>,</span>
<span>  outcome <span class="op">=</span> <span class="va">vars</span><span class="op">$</span><span class="va">outcome</span>,</span>
<span>  covariates <span class="op">=</span> <span class="st">"BASVAL"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Analyse MAR imputation with derived delta adjustment</span></span>
<span><span class="va">anaObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyse.html">analyse</a></span><span class="op">(</span></span>
<span>  <span class="va">imputeObj</span>,</span>
<span>  <span class="fu">rbmi</span><span class="fu">::</span><span class="va"><a href="../reference/ancova.html">ancova</a></span>,</span>
<span>  vars <span class="op">=</span> <span class="va">vars_an</span></span>
<span><span class="op">)</span></span>
<span><span class="va">anaObj</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Analysis Object</span></span>
<span><span class="co">#&gt; ---------------</span></span>
<span><span class="co">#&gt; Number of Results: 1 + 172</span></span>
<span><span class="co">#&gt; Analysis Function: rbmi::ancova</span></span>
<span><span class="co">#&gt; Delta Applied: FALSE</span></span>
<span><span class="co">#&gt; Analysis Estimates:</span></span>
<span><span class="co">#&gt;     trt_4</span></span>
<span><span class="co">#&gt;     lsm_ref_4</span></span>
<span><span class="co">#&gt;     lsm_alt_4</span></span>
<span><span class="co">#&gt;     trt_5</span></span>
<span><span class="co">#&gt;     lsm_ref_5</span></span>
<span><span class="co">#&gt;     lsm_alt_5</span></span>
<span><span class="co">#&gt;     trt_6</span></span>
<span><span class="co">#&gt;     lsm_ref_6</span></span>
<span><span class="co">#&gt;     lsm_alt_6</span></span>
<span><span class="co">#&gt;     trt_7</span></span>
<span><span class="co">#&gt;     lsm_ref_7</span></span>
<span><span class="co">#&gt;     lsm_alt_7</span></span></code></pre></div>
</div>
<div class="section level3" number="3.4">
<h3 id="pool">
<span class="header-section-number">3.4</span> Pool<a class="anchor" aria-label="anchor" href="#pool"></a>
</h3>
<p>Finally, we can extract the treatment effect estimates and perform inference using the jackknife variance estimator. This is done by calling the <code><a href="../reference/pool.html">pool()</a></code> function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poolObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pool.html">pool</a></span><span class="op">(</span><span class="va">anaObj</span><span class="op">)</span></span>
<span><span class="va">poolObj</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Pool Object</span></span>
<span><span class="co">#&gt; -----------</span></span>
<span><span class="co">#&gt; Number of Results Combined: 1 + 172</span></span>
<span><span class="co">#&gt; Method: jackknife</span></span>
<span><span class="co">#&gt; Confidence Level: 0.95</span></span>
<span><span class="co">#&gt; Alternative: two.sided</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Results:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   ==================================================</span></span>
<span><span class="co">#&gt;    parameter   est     se     lci     uci     pval  </span></span>
<span><span class="co">#&gt;   --------------------------------------------------</span></span>
<span><span class="co">#&gt;      trt_4    -0.092  0.695  -1.453   1.27   0.895  </span></span>
<span><span class="co">#&gt;    lsm_ref_4  -1.616  0.588  -2.767  -0.464  0.006  </span></span>
<span><span class="co">#&gt;    lsm_alt_4  -1.708  0.396  -2.484  -0.931  &lt;0.001 </span></span>
<span><span class="co">#&gt;      trt_5    1.305   0.878  -0.416  3.027   0.137  </span></span>
<span><span class="co">#&gt;    lsm_ref_5  -4.133  0.688  -5.481  -2.785  &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_alt_5  -2.828  0.604  -4.011  -1.645  &lt;0.001 </span></span>
<span><span class="co">#&gt;      trt_6    1.929   0.862  0.239   3.619   0.025  </span></span>
<span><span class="co">#&gt;    lsm_ref_6  -6.088  0.671  -7.402  -4.773  &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_alt_6  -4.159  0.686  -5.503  -2.815  &lt;0.001 </span></span>
<span><span class="co">#&gt;      trt_7    2.126   0.858  0.444   3.807   0.013  </span></span>
<span><span class="co">#&gt;    lsm_ref_7  -6.965  0.685  -8.307  -5.622  &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_alt_7  -4.839  0.762  -6.333  -3.346  &lt;0.001 </span></span>
<span><span class="co">#&gt;   --------------------------------------------------</span></span></code></pre></div>
<p>This gives an estimated treatment effect of
2.13 (95% CI 0.44 to 3.81)
at the last visit with an associated p-value of 0.013.</p>
</div>
</div>
<div class="section level2" number="4">
<h2 id="reference-based-conditional-mean-imputation---information-anchored-inference">
<span class="header-section-number">4</span> Reference-based conditional mean imputation - information-anchored inference<a class="anchor" aria-label="anchor" href="#reference-based-conditional-mean-imputation---information-anchored-inference"></a>
</h2>
<p>In this section, we present how the estimation process based on conditional mean imputation combined with the jackknife can be adapted to obtain an information-anchored variance following the proposal by <span class="citation">Lu (<a href="#ref-Lu2021">2021</a>)</span>.</p>
<div class="section level3" number="4.1">
<h3 id="draws-1">
<span class="header-section-number">4.1</span> Draws<a class="anchor" aria-label="anchor" href="#draws-1"></a>
</h3>
<p>The code for the pre-processing of the dataset and for the “draws” step is equivalent to the code provided for the frequentist inference. Please refer to <a href="#draws">that section</a> for details about this step.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://insightsengineering.github.io/rbmi/">rbmi</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">antidepressant_data</span></span>
<span></span>
<span><span class="co"># Use expand_locf to add rows corresponding to visits with missing outcomes to</span></span>
<span><span class="co"># the dataset</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/expand.html">expand_locf</a></span><span class="op">(</span></span>
<span>  <span class="va">dat</span>,</span>
<span>  PATIENT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">PATIENT</span><span class="op">)</span>, <span class="co"># expand by PATIENT and VISIT </span></span>
<span>  VISIT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">VISIT</span><span class="op">)</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BASVAL"</span>, <span class="st">"THERAPY"</span><span class="op">)</span>, <span class="co"># fill with LOCF BASVAL and THERAPY</span></span>
<span>  group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PATIENT"</span><span class="op">)</span>,</span>
<span>  order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PATIENT"</span>, <span class="st">"VISIT"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create data_ice and set the imputation strategy to JR for</span></span>
<span><span class="co"># each patient with at least one missing observation</span></span>
<span><span class="va">dat_ice</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">PATIENT</span>, <span class="va">VISIT</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">CHANGE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">PATIENT</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">PATIENT</span>, <span class="va">VISIT</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>strategy <span class="op">=</span> <span class="st">"JR"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># In this dataset, subject 3618 has an intermittent missing values which</span></span>
<span><span class="co"># does not correspond to a study drug discontinuation. We therefore remove</span></span>
<span><span class="co"># this subject from `dat_ice`. (In the later imputation step, it will</span></span>
<span><span class="co"># automatically be imputed under the default MAR assumption.)</span></span>
<span><span class="va">dat_ice</span> <span class="op">&lt;-</span> <span class="va">dat_ice</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">dat_ice</span><span class="op">$</span><span class="va">PATIENT</span> <span class="op">==</span> <span class="fl">3618</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># Define the names of key variables in our dataset and</span></span>
<span><span class="co"># the covariates included in the imputation model using `set_vars()`</span></span>
<span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_vars.html">set_vars</a></span><span class="op">(</span></span>
<span>  outcome <span class="op">=</span> <span class="st">"CHANGE"</span>,</span>
<span>  visit <span class="op">=</span> <span class="st">"VISIT"</span>,</span>
<span>  subjid <span class="op">=</span> <span class="st">"PATIENT"</span>,</span>
<span>  group <span class="op">=</span> <span class="st">"THERAPY"</span>,</span>
<span>  covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BASVAL*VISIT"</span>, <span class="st">"THERAPY*VISIT"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define which imputation method to use (here: conditional mean imputation</span></span>
<span><span class="co"># with jackknife as resampling) </span></span>
<span><span class="va">method</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/method.html">method_condmean</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"jackknife"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create samples for the imputation parameters by running the draws() function</span></span>
<span><span class="va">drawObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draws.html">draws</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">dat</span>,</span>
<span>  data_ice <span class="op">=</span> <span class="va">dat_ice</span>,</span>
<span>  vars <span class="op">=</span> <span class="va">vars</span>,</span>
<span>  method <span class="op">=</span> <span class="va">method</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">drawObj</span></span></code></pre></div>
</div>
<div class="section level3" number="4.2">
<h3 id="imputation-step-including-calculation-of-delta-adjustment">
<span class="header-section-number">4.2</span> Imputation step including calculation of delta-adjustment<a class="anchor" aria-label="anchor" href="#imputation-step-including-calculation-of-delta-adjustment"></a>
</h3>
<p>The proposal by <span class="citation">Lu (<a href="#ref-Lu2021">2021</a>)</span> is to replace the reference-based imputation by a MAR imputation combined with a delta-adjustment where delta is selected in a data-driven way to match the reference-based estimator.
In <code>rbmi</code>, this is implemented by first performing the imputation under the defined reference-based imputation strategy (here JR) as well as under MAR separately.
Second, the delta-adjustment is defined as the difference between the conditional mean imputation under reference-based and MAR imputation, respectively, on the original dataset.</p>
<p>To simplify the implementation, we have written a function <code>get_delta_match_refBased</code> that performs this step.
The function takes as input arguments the <code>draws</code> object, <code>data_ice</code> (i.e. the <code>data.frame</code> containing the information about the intercurrent events and the imputation strategies), and <code>references</code>, a named vector that identifies the references to be used for reference-based imputation methods.
The function returns a list containing the imputation objects under both reference-based and MAR imputation, plus a <code>data.frame</code> which contains the delta-adjustment.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#' Get delta adjustment that matches reference-based imputation</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' @param draws: A `draws` object created by `draws()`.</span></span>
<span><span class="co">#' @param data_ice: `data.frame` containing the information about the intercurrent</span></span>
<span><span class="co">#' events and the imputation strategies. Must represent the desired imputation</span></span>
<span><span class="co">#' strategy and not the MAR-variant.</span></span>
<span><span class="co">#' @param references: A named vector. Identifies the references to be used</span></span>
<span><span class="co">#' for reference-based imputation methods.</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' @return </span></span>
<span><span class="co">#' The function returns a list containing the imputation objects under both</span></span>
<span><span class="co">#' reference-based and MAR imputation, plus a `data.frame` which contains the</span></span>
<span><span class="co">#' delta-adjustment.</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' @seealso `draws()`, `impute()`.</span></span>
<span><span class="va">get_delta_match_refBased</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">draws</span>, <span class="va">data_ice</span>, <span class="va">references</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Impute according to `data_ice`</span></span>
<span>  <span class="va">imputeObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/impute.html">impute</a></span><span class="op">(</span></span>
<span>    draws <span class="op">=</span> <span class="va">drawObj</span>,</span>
<span>    update_strategy <span class="op">=</span> <span class="va">data_ice</span>,</span>
<span>    references <span class="op">=</span> <span class="va">references</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">vars</span> <span class="op">&lt;-</span> <span class="va">imputeObj</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">vars</span></span>
<span>  </span>
<span>  <span class="co"># Access imputed dataset (index=1 for method_condmean(type = "jackknife"))</span></span>
<span>  <span class="va">cmi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_imputed_dfs.html">extract_imputed_dfs</a></span><span class="op">(</span><span class="va">imputeObj</span>, index <span class="op">=</span> <span class="fl">1</span>, idmap <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">idmap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">cmi</span><span class="op">)</span><span class="op">$</span><span class="va">idmap</span></span>
<span>  <span class="va">cmi</span> <span class="op">&lt;-</span> <span class="va">cmi</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">vars</span><span class="op">$</span><span class="va">subjid</span>, <span class="va">vars</span><span class="op">$</span><span class="va">visit</span>, <span class="va">vars</span><span class="op">$</span><span class="va">outcome</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">cmi</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">cmi</span><span class="op">)</span> <span class="op">==</span> <span class="va">vars</span><span class="op">$</span><span class="va">outcome</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"y_imp"</span></span>
<span>  </span>
<span>  <span class="co"># Map back original patients id since `rbmi` re-code ids to ensure id uniqueness</span></span>
<span>  </span>
<span>  <span class="va">cmi</span><span class="op">[[</span><span class="va">vars</span><span class="op">$</span><span class="va">subjid</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">idmap</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">cmi</span><span class="op">[[</span><span class="va">vars</span><span class="op">$</span><span class="va">subjid</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">idmap</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Derive conditional mean imputations under MAR</span></span>
<span>  <span class="va">dat_ice_MAR</span> <span class="op">&lt;-</span> <span class="va">data_ice</span> </span>
<span>  <span class="va">dat_ice_MAR</span><span class="op">[[</span><span class="va">vars</span><span class="op">$</span><span class="va">strategy</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"MAR"</span></span>
<span>  </span>
<span>  <span class="co"># Impute under MAR </span></span>
<span>  <span class="co"># Note that in this specific context, it is desirable that an update   </span></span>
<span></span>
<span>  <span class="co"># from a reference-based strategy to MAR uses the exact same data for </span></span>
<span>  <span class="co"># fitting the imputation models, i.e. that available post-ICE data are </span></span>
<span>  <span class="co"># omitted from the imputation model for both. This is the case when    </span></span>
<span>  <span class="co"># using argument update_strategy in function impute(). </span></span>
<span>  <span class="co"># However, for other settings (i.e. if one is interested in switching to</span></span>
<span>  <span class="co"># a standard MAR imputation strategy altogether), this behavior is  </span></span>
<span>  <span class="co"># undesirable and, consequently, the function throws a warning which </span></span>
<span>  <span class="co"># we suppress here. </span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span></span>
<span>    <span class="va">imputeObj_MAR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/impute.html">impute</a></span><span class="op">(</span></span>
<span>      <span class="va">draws</span>,</span>
<span>      update_strategy <span class="op">=</span> <span class="va">dat_ice_MAR</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> </span>
<span>  </span>
<span>  <span class="co"># Access imputed dataset (index=1 for method_condmean(type = "jackknife"))</span></span>
<span>  <span class="va">cmi_MAR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_imputed_dfs.html">extract_imputed_dfs</a></span><span class="op">(</span><span class="va">imputeObj_MAR</span>, index <span class="op">=</span> <span class="fl">1</span>, idmap <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">idmap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">cmi_MAR</span><span class="op">)</span><span class="op">$</span><span class="va">idmap</span></span>
<span>  <span class="va">cmi_MAR</span> <span class="op">&lt;-</span> <span class="va">cmi_MAR</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">vars</span><span class="op">$</span><span class="va">subjid</span>, <span class="va">vars</span><span class="op">$</span><span class="va">visit</span>, <span class="va">vars</span><span class="op">$</span><span class="va">outcome</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">cmi_MAR</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">cmi_MAR</span><span class="op">)</span> <span class="op">==</span> <span class="va">vars</span><span class="op">$</span><span class="va">outcome</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"y_MAR"</span></span>
<span>  </span>
<span>  <span class="co"># Map back original patients id since `rbmi` re-code ids to ensure id uniqueness</span></span>
<span>  <span class="va">cmi_MAR</span><span class="op">[[</span><span class="va">vars</span><span class="op">$</span><span class="va">subjid</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">idmap</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">cmi_MAR</span><span class="op">[[</span><span class="va">vars</span><span class="op">$</span><span class="va">subjid</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">idmap</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Derive delta adjustment "aligned with ref-based imputation",</span></span>
<span>  <span class="co"># i.e. difference between ref-based imputation and MAR imputation</span></span>
<span>  <span class="va">delta_adjust</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">cmi</span>, <span class="va">cmi_MAR</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">vars</span><span class="op">$</span><span class="va">subjid</span>, <span class="va">vars</span><span class="op">$</span><span class="va">visit</span><span class="op">)</span>, all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">delta_adjust</span><span class="op">$</span><span class="va">delta</span> <span class="op">&lt;-</span> <span class="va">delta_adjust</span><span class="op">$</span><span class="va">y_imp</span> <span class="op">-</span> <span class="va">delta_adjust</span><span class="op">$</span><span class="va">y_MAR</span></span>
<span></span>
<span>  <span class="va">ret_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    imputeObj <span class="op">=</span> <span class="va">imputeObj</span>,</span>
<span>    imputeObj_MAR <span class="op">=</span> <span class="va">imputeObj_MAR</span>,</span>
<span>    delta_adjust <span class="op">=</span> <span class="va">delta_adjust</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">ret_obj</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">references</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DRUG"</span> <span class="op">=</span> <span class="st">"PLACEBO"</span>, <span class="st">"PLACEBO"</span> <span class="op">=</span> <span class="st">"PLACEBO"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">res_delta_adjust</span> <span class="op">&lt;-</span> <span class="fu">get_delta_match_refBased</span><span class="op">(</span><span class="va">drawObj</span>, <span class="va">dat_ice</span>, <span class="va">references</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3" number="4.3">
<h3 id="analyse-1">
<span class="header-section-number">4.3</span> Analyse<a class="anchor" aria-label="anchor" href="#analyse-1"></a>
</h3>
<p>We use the function <code><a href="../reference/analyse.html">analyse()</a></code> to add the delta-adjustment and perform the analysis of the imputed datasets under MAR.
<code><a href="../reference/analyse.html">analyse()</a></code> will take as the input argument <code>imputations = res_delta_adjust$imputeObj_MAR</code>, i.e. the imputation object corresponding to the MAR imputation (and not the JR imputation).
The argument <code>delta</code> can be used to add a delta-adjustment prior to the analysis and we set this to the delta-adjustment obtained in the previous step: <code>delta = res_delta_adjust$delta_adjust</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Set analysis variables using `rbmi` function "set_vars"</span></span>
<span><span class="va">vars_an</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_vars.html">set_vars</a></span><span class="op">(</span></span>
<span>  group <span class="op">=</span> <span class="va">vars</span><span class="op">$</span><span class="va">group</span>,</span>
<span>  visit <span class="op">=</span> <span class="va">vars</span><span class="op">$</span><span class="va">visit</span>,</span>
<span>  outcome <span class="op">=</span> <span class="va">vars</span><span class="op">$</span><span class="va">outcome</span>,</span>
<span>  covariates <span class="op">=</span> <span class="st">"BASVAL"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Analyse MAR imputation with derived delta adjustment</span></span>
<span><span class="va">anaObj_MAR_delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyse.html">analyse</a></span><span class="op">(</span></span>
<span>  <span class="va">res_delta_adjust</span><span class="op">$</span><span class="va">imputeObj_MAR</span>,</span>
<span>  <span class="fu">rbmi</span><span class="fu">::</span><span class="va"><a href="../reference/ancova.html">ancova</a></span>,</span>
<span>  delta <span class="op">=</span> <span class="va">res_delta_adjust</span><span class="op">$</span><span class="va">delta_adjust</span>,</span>
<span>  vars <span class="op">=</span> <span class="va">vars_an</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3" number="4.4">
<h3 id="pool-1">
<span class="header-section-number">4.4</span> Pool<a class="anchor" aria-label="anchor" href="#pool-1"></a>
</h3>
<p>We can finally use the <code><a href="../reference/pool.html">pool()</a></code> function to extract the treatment effect estimate (as well as the estimated marginal means) at each visit and apply the jackknife variance estimator to the analysis estimates from all the imputed leave-one-out samples.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">poolObj_MAR_delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pool.html">pool</a></span><span class="op">(</span><span class="va">anaObj_MAR_delta</span><span class="op">)</span></span>
<span><span class="va">poolObj_MAR_delta</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Pool Object</span></span>
<span><span class="co">#&gt; -----------</span></span>
<span><span class="co">#&gt; Number of Results Combined: 1 + 172</span></span>
<span><span class="co">#&gt; Method: jackknife</span></span>
<span><span class="co">#&gt; Confidence Level: 0.95</span></span>
<span><span class="co">#&gt; Alternative: two.sided</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Results:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   ==================================================</span></span>
<span><span class="co">#&gt;    parameter   est     se     lci     uci     pval  </span></span>
<span><span class="co">#&gt;   --------------------------------------------------</span></span>
<span><span class="co">#&gt;      trt_4    -0.092  0.695  -1.453   1.27   0.895  </span></span>
<span><span class="co">#&gt;    lsm_ref_4  -1.616  0.588  -2.767  -0.464  0.006  </span></span>
<span><span class="co">#&gt;    lsm_alt_4  -1.708  0.396  -2.484  -0.931  &lt;0.001 </span></span>
<span><span class="co">#&gt;      trt_5    1.305   0.944  -0.545  3.156   0.167  </span></span>
<span><span class="co">#&gt;    lsm_ref_5  -4.133  0.738  -5.579  -2.687  &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_alt_5  -2.828  0.603  -4.01   -1.646  &lt;0.001 </span></span>
<span><span class="co">#&gt;      trt_6    1.929   0.993  -0.018  3.876   0.052  </span></span>
<span><span class="co">#&gt;    lsm_ref_6  -6.088  0.758  -7.574  -4.602  &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_alt_6  -4.159  0.686  -5.504  -2.813  &lt;0.001 </span></span>
<span><span class="co">#&gt;      trt_7    2.126   1.123  -0.076  4.327   0.058  </span></span>
<span><span class="co">#&gt;    lsm_ref_7  -6.965  0.85   -8.63   -5.299  &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_alt_7  -4.839  0.763  -6.335  -3.343  &lt;0.001 </span></span>
<span><span class="co">#&gt;   --------------------------------------------------</span></span></code></pre></div>
<p>This gives an estimated treatment effect of
2.13 (95% CI -0.08 to 4.33)
at the last visit with an associated p-value of 0.058.
Per construction of the delta-adjustment, the point estimate is identical to the frequentist analysis. However, its standard error is much larger (1.12 vs. 0.86).
Indeed, the information-anchored standard error (and the resulting inference) is very similar to the results for Baysesian multiple imputation using Rubin’s rules for which a standard error of 1.13 was reported in the quickstart vignette (<code>vignette(topic = "quickstart", package = "rbmi"</code>).
Of note, as shown e.g. in <span class="citation">Wolbers et al. (<a href="#ref-Wolbers2021">2022</a>)</span>, hypothesis testing based on the information-anchored inference is very conservative, i.e. the actual type I error is much lower than the nominal value. Hence, confidence intervals and <span class="math inline">\(p\)</span>-values based on information-anchored inference should be interpreted with caution.</p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Bartlett2021" class="csl-entry">
Bartlett, Jonathan W. 2023. <span>“Reference-Based Multiple Imputation - What Is the Right Variance and How to Estimate It.”</span> <em>Statistics in Biopharmaceutical Research</em> 15 (1): 178–86.
</div>
<div id="ref-CroEtAl2019" class="csl-entry">
Cro, Suzie, James R Carpenter, and Michael G Kenward. 2019. <span>“Information-Anchored Sensitivity Analysis: Theory and Application.”</span> <em>Journal of the Royal Statistical Society: Series A (Statistics in Society)</em> 182 (2): 623–45.
</div>
<div id="ref-Lu2021" class="csl-entry">
Lu, Kaifeng. 2021. <span>“An Alternative Implementation of Reference-Based Controlled Imputation Procedures.”</span> <em>Statistics in Biopharmaceutical Research</em> 13 (4): 483–91.
</div>
<div id="ref-Wolbers2021" class="csl-entry">
Wolbers, Marcel, Alessandro Noci, Paul Delmar, Craig Gower-Page, Sean Yiu, and Jonathan W Bartlett. 2022. <span>“Standard and Reference-Based Conditional Mean Imputation.”</span> <em>Pharmaceutical Statistics</em> 21 (6): 1246–57.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Isaac Gravestock, Craig Gower-Page, Alessandro Noci, Daniel Sabanes Bove, F. Hoffmann-La Roche AG.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
