<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rbmi">
<title>rbmi: Quickstart • rbmi</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="rbmi: Quickstart">
<meta property="og:description" content="rbmi">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rbmi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.6</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/CondMean_Inference.html">rbmi: Inference with Conditional Mean Imputation</a>
    <a class="dropdown-item" href="../articles/FAQ.html">rbmi: Frequently Asked Questions</a>
    <a class="dropdown-item" href="../articles/advanced.html">rbmi: Advanced Functionality</a>
    <a class="dropdown-item" href="../articles/quickstart.html">rbmi: Quickstart</a>
    <a class="dropdown-item" href="../articles/stat_specs.html">rbmi: Statistical Specifications</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/insightsengineering/rbmi/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>rbmi: Quickstart</h1>
                        <h4 data-toc-skip class="author">Craig Gower-Page, Alessandro Noci, and Marcel Wolbers</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/insightsengineering/rbmi/blob/HEAD/vignettes/quickstart.Rmd" class="external-link"><code>vignettes/quickstart.Rmd</code></a></small>
      <div class="d-none name"><code>quickstart.Rmd</code></div>
    </div>

    
    
<div class="section level2" number="1">
<h2 id="introduction">
<span class="header-section-number">1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The purpose of this vignette is to provide a 15 minute quickstart guide to the core functions of the rbmi package.</p>
<p>The rbmi package consists of 4 core functions (plus several helper functions) which are typically called in sequence:</p>
<ul>
<li>
<code><a href="../reference/draws.html">draws()</a></code> - fits the imputation models and stores their parameters</li>
<li>
<code><a href="../reference/impute.html">impute()</a></code> - creates multiple imputed datasets</li>
<li>
<code><a href="../reference/analyse.html">analyse()</a></code> - analyses each of the multiple imputed datasets</li>
<li>
<code><a href="../reference/pool.html">pool()</a></code> - combines the analysis results across imputed datasets into a single statistic</li>
</ul>
</div>
<div class="section level2" number="2">
<h2 id="the-data">
<span class="header-section-number">2</span> The Data<a class="anchor" aria-label="anchor" href="#the-data"></a>
</h2>
<p>We use a publicly available example dataset from an antidepressant clinical trial of an active drug versus placebo. The relevant endpoint is the Hamilton 17-item depression rating scale (HAMD17) which was assessed at baseline and at weeks 1, 2, 4, and 6. Study drug discontinuation occurred in 24% of subjects from the active drug and 26% of subjects from placebo. All data after study drug discontinuation are missing and there is a single additional intermittent missing observation.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://insightsengineering.github.io/rbmi/" class="external-link">rbmi</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"antidepressant_data"</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">antidepressant_data</span></span></code></pre></div>
<p>We consider an imputation model with the mean change from baseline in the HAMD17 score as the outcome (variable <code>CHANGE</code> in the dataset). The following covariates are included in the imputation model: the treatment group (<code>THERAPY</code>), the (categorical) visit (<code>VISIT</code>), treatment-by-visit interactions, the baseline HAMD17 score (<code>BASVAL</code>), and baseline HAMD17 score-by-visit interactions. A common unstructured covariance matrix structure is assumed for both groups. The analysis model is an ANCOVA model with the treatment group as the primary factor and adjustment for the baseline HAMD17 score.</p>
<p><code>rbmi</code> expects its input dataset to be complete; that is, there must be one row per subject for each visit. Missing outcome values should be coded as <code>NA</code>, while missing covariate values are not allowed. If the dataset is incomplete, then the <code><a href="../reference/expand.html">expand_locf()</a></code> helper function can be used to add any missing rows, using LOCF imputation to carry forward the observed baseline covariate values to visits with missing outcomes. Rows corresponding to missing outcomes are not present in the antidepressant trial dataset. To address this we will therefore use the <code><a href="../reference/expand.html">expand_locf()</a></code> function as follows:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Use expand_locf to add rows corresponding to visits with missing outcomes to the dataset</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/expand.html">expand_locf</a></span><span class="op">(</span></span>
<span>    <span class="va">dat</span>,</span>
<span>    PATIENT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">PATIENT</span><span class="op">)</span>, <span class="co"># expand by PATIENT and VISIT </span></span>
<span>    VISIT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">VISIT</span><span class="op">)</span>,</span>
<span>    vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BASVAL"</span>, <span class="st">"THERAPY"</span><span class="op">)</span>, <span class="co"># fill with LOCF BASVAL and THERAPY</span></span>
<span>    group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PATIENT"</span><span class="op">)</span>,</span>
<span>    order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PATIENT"</span>, <span class="st">"VISIT"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2" number="3">
<h2 id="draws">
<span class="header-section-number">3</span> Draws<a class="anchor" aria-label="anchor" href="#draws"></a>
</h2>
<p>The <code><a href="../reference/draws.html">draws()</a></code> function fits the imputation models and stores the corresponding parameter estimates or Bayesian posterior parameter draws.
The three main inputs to the <code><a href="../reference/draws.html">draws()</a></code> function are:</p>
<ul>
<li>
<code>data</code> - The primary longitudinal data.frame containing the outcome variable and all covariates.</li>
<li>
<code>data_ice</code> - A data.frame which specifies the first visit affected by an intercurrent event (ICE) and the imputation strategy for handling missing outcome data after the ICE. At most one ICE which is to be imputed by a non-MAR strategy is allowed per subject.</li>
<li>
<code>method</code> - The statistical method used to fit the imputation models and to create imputed datasets.</li>
</ul>
<p>For the antidepressant trial data, the dataset <code>data_ice</code> is not provided. However, it can be derived because, in this dataset,
the subject’s first visit affected by the ICE “study drug discontinuation” corresponds to the first terminal missing observation.
We first derive the dateset <code>data_ice</code> and then create 150 Bayesian posterior draws of the imputation model parameters.</p>
<p>For this example, we assume that the imputation strategy after the ICE is Jump To Reference (JR) for all subjects
and that 150 multiple imputed datasets using Bayesian posterior draws from the imputation model are to be created.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create data_ice and set the imputation strategy to JR for</span></span>
<span><span class="co"># each patient with at least one missing observation</span></span>
<span><span class="va">dat_ice</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">PATIENT</span>, <span class="va">VISIT</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">CHANGE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">PATIENT</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">PATIENT</span>, <span class="va">VISIT</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>strategy <span class="op">=</span> <span class="st">"JR"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># In this dataset, subject 3618 has an intermittent missing values which does not correspond</span></span>
<span><span class="co"># to a study drug discontinuation. We therefore remove this subject from `dat_ice`. </span></span>
<span><span class="co"># (In the later imputation step, it will automatically be imputed under the default MAR assumption.)</span></span>
<span><span class="va">dat_ice</span> <span class="op">&lt;-</span> <span class="va">dat_ice</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">dat_ice</span><span class="op">$</span><span class="va">PATIENT</span> <span class="op">==</span> <span class="fl">3618</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">dat_ice</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 43 × 3</span></span></span>
<span><span class="co">#&gt;    PATIENT VISIT strategy</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1513    5     JR      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1514    5     JR      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1517    5     JR      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1804    7     JR      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2104    7     JR      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2118    5     JR      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2218    6     JR      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2230    6     JR      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2721    5     JR      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2729    5     JR      </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 33 more rows</span></span></span>
<span></span>
<span><span class="co"># Define the names of key variables in our dataset and</span></span>
<span><span class="co"># the covariates included in the imputation model using `set_vars()`</span></span>
<span><span class="co"># Note that the covariates argument can also include interaction terms</span></span>
<span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_vars.html">set_vars</a></span><span class="op">(</span></span>
<span>    outcome <span class="op">=</span> <span class="st">"CHANGE"</span>,</span>
<span>    visit <span class="op">=</span> <span class="st">"VISIT"</span>,</span>
<span>    subjid <span class="op">=</span> <span class="st">"PATIENT"</span>,</span>
<span>    group <span class="op">=</span> <span class="st">"THERAPY"</span>,</span>
<span>    covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BASVAL*VISIT"</span>, <span class="st">"THERAPY*VISIT"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define which imputation method to use (here: Bayesian multiple imputation with 150 imputed datsets) </span></span>
<span><span class="va">method</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/method.html">method_bayes</a></span><span class="op">(</span></span>
<span>    burn_in <span class="op">=</span> <span class="fl">200</span>,</span>
<span>    burn_between <span class="op">=</span> <span class="fl">5</span>,</span>
<span>    n_samples <span class="op">=</span> <span class="fl">150</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">675442751</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create samples for the imputation parameters by running the draws() function</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">987</span><span class="op">)</span></span>
<span><span class="va">drawObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draws.html">draws</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">dat</span>,</span>
<span>    data_ice <span class="op">=</span> <span class="va">dat_ice</span>,</span>
<span>    vars <span class="op">=</span> <span class="va">vars</span>,</span>
<span>    method <span class="op">=</span> <span class="va">method</span>,</span>
<span>    quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">drawObj</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Draws Object</span></span>
<span><span class="co">#&gt; ------------</span></span>
<span><span class="co">#&gt; Number of Samples: 150</span></span>
<span><span class="co">#&gt; Number of Failed Samples: 0</span></span>
<span><span class="co">#&gt; Model Formula: CHANGE ~ 1 + THERAPY + VISIT + BASVAL * VISIT + THERAPY * VISIT</span></span>
<span><span class="co">#&gt; Imputation Type: random</span></span>
<span><span class="co">#&gt; Method:</span></span>
<span><span class="co">#&gt;     name: Bayes</span></span>
<span><span class="co">#&gt;     burn_in: 200</span></span>
<span><span class="co">#&gt;     burn_between: 5</span></span>
<span><span class="co">#&gt;     same_cov: TRUE</span></span>
<span><span class="co">#&gt;     n_samples: 150</span></span>
<span><span class="co">#&gt;     seed: 675442751</span></span></code></pre></div>
<p>Note the use of <code><a href="../reference/set_vars.html">set_vars()</a></code> which specifies the names of the key variables
within the dataset and the imputation model. Additionally, note that whilst <code>vars$group</code> and <code>vars$visit</code>
are added as terms to the imputation model by default, their interaction is not,
thus the inclusion of <code>group * visit</code> in the list of covariates.</p>
<p>Available imputation methods include:</p>
<ul>
<li>Bayesian multiple imputation - <code><a href="../reference/method.html">method_bayes()</a></code>
</li>
<li>Approximate Bayesian multiple imputation - <code><a href="../reference/method.html">method_approxbayes()</a></code>
</li>
<li>Conditional mean imputation (bootstrap) - <code>method_condmean(type = "bootstrap")</code>
</li>
<li>Conditional mean imputation (jackknife) - <code>method_condmean(type = "jackknife")</code>
</li>
<li>Bootstrapped multiple imputation - <code>method = method_bmlmi()</code>
</li>
</ul>
<p>For a comparison of these methods, we refer to the <code>stat_specs</code> vignette (Section 3.10).</p>
<p>“statistical specifications” vignette (Section 3.10): <code><a href="../articles/stat_specs.html">vignette("stat_specs",package="rbmi")</a></code>.</p>
<p>Available imputation strategies include:</p>
<ul>
<li>Missing At Random - <code>"MAR"</code>
</li>
<li>Jump to Reference - <code>"JR"</code>
</li>
<li>Copy Reference - <code>"CR"</code>
</li>
<li>Copy Increments from Reference - <code>"CIR"</code>
</li>
<li>Last Mean Carried Forward - <code>"LMCF"</code>
</li>
</ul>
</div>
<div class="section level2" number="4">
<h2 id="impute">
<span class="header-section-number">4</span> Impute<a class="anchor" aria-label="anchor" href="#impute"></a>
</h2>
<p>The next step is to use the parameters from the imputation model to generate the imputed datasets. This is
done via the <code><a href="../reference/impute.html">impute()</a></code> function. The function only has two key inputs: the imputation
model output from <code><a href="../reference/draws.html">draws()</a></code> and the reference groups relevant to reference-based imputation methods. It’s usage is thus:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imputeObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/impute.html">impute</a></span><span class="op">(</span></span>
<span>    <span class="va">drawObj</span>,</span>
<span>    references <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DRUG"</span> <span class="op">=</span> <span class="st">"PLACEBO"</span>, <span class="st">"PLACEBO"</span> <span class="op">=</span> <span class="st">"PLACEBO"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">imputeObj</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Imputation Object</span></span>
<span><span class="co">#&gt; -----------------</span></span>
<span><span class="co">#&gt; Number of Imputed Datasets: 150</span></span>
<span><span class="co">#&gt; Fraction of Missing Data (Original Dataset):</span></span>
<span><span class="co">#&gt;     4:   0%</span></span>
<span><span class="co">#&gt;     5:   8%</span></span>
<span><span class="co">#&gt;     6:  13%</span></span>
<span><span class="co">#&gt;     7:  25%</span></span>
<span><span class="co">#&gt; References:</span></span>
<span><span class="co">#&gt;     DRUG    -&gt; PLACEBO</span></span>
<span><span class="co">#&gt;     PLACEBO -&gt; PLACEBO</span></span></code></pre></div>
<p>In this instance, we are specifying that the <code>PLACEBO</code> group should be the reference group for itself as well as for the <code>DRUG</code> group (as is standard for imputation using reference-based methods).</p>
<p>Generally speaking, there is no need to see or directly interact with the imputed
datasets. However, if you do wish to inspect them, they can be extracted from the imputation
object using the <code><a href="../reference/extract_imputed_dfs.html">extract_imputed_dfs()</a></code> helper function, i.e.:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imputed_dfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_imputed_dfs.html">extract_imputed_dfs</a></span><span class="op">(</span><span class="va">imputeObj</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">imputed_dfs</span><span class="op">[[</span><span class="fl">10</span><span class="op">]</span><span class="op">]</span>, <span class="fl">12</span><span class="op">)</span> <span class="co"># first 12 rows of 10th imputed dataset</span></span>
<span><span class="co">#&gt;     PATIENT HAMATOTL PGIIMP RELDAYS VISIT THERAPY GENDER POOLINV BASVAL</span></span>
<span><span class="co">#&gt; 1  new_pt_1       21      2       7     4    DRUG      F     006     32</span></span>
<span><span class="co">#&gt; 2  new_pt_1       19      2      14     5    DRUG      F     006     32</span></span>
<span><span class="co">#&gt; 3  new_pt_1       21      3      28     6    DRUG      F     006     32</span></span>
<span><span class="co">#&gt; 4  new_pt_1       17      4      42     7    DRUG      F     006     32</span></span>
<span><span class="co">#&gt; 5  new_pt_2       18      3       7     4 PLACEBO      F     006     14</span></span>
<span><span class="co">#&gt; 6  new_pt_2       18      2      15     5 PLACEBO      F     006     14</span></span>
<span><span class="co">#&gt; 7  new_pt_2       14      3      29     6 PLACEBO      F     006     14</span></span>
<span><span class="co">#&gt; 8  new_pt_2        8      2      42     7 PLACEBO      F     006     14</span></span>
<span><span class="co">#&gt; 9  new_pt_3       18      3       7     4    DRUG      F     006     21</span></span>
<span><span class="co">#&gt; 10 new_pt_3       17      3      14     5    DRUG      F     006     21</span></span>
<span><span class="co">#&gt; 11 new_pt_3       12      3      28     6    DRUG      F     006     21</span></span>
<span><span class="co">#&gt; 12 new_pt_3        9      3      44     7    DRUG      F     006     21</span></span>
<span><span class="co">#&gt;    HAMDTL17 CHANGE</span></span>
<span><span class="co">#&gt; 1        21    -11</span></span>
<span><span class="co">#&gt; 2        20    -12</span></span>
<span><span class="co">#&gt; 3        19    -13</span></span>
<span><span class="co">#&gt; 4        17    -15</span></span>
<span><span class="co">#&gt; 5        11     -3</span></span>
<span><span class="co">#&gt; 6        14      0</span></span>
<span><span class="co">#&gt; 7         9     -5</span></span>
<span><span class="co">#&gt; 8         5     -9</span></span>
<span><span class="co">#&gt; 9        20     -1</span></span>
<span><span class="co">#&gt; 10       18     -3</span></span>
<span><span class="co">#&gt; 11       16     -5</span></span>
<span><span class="co">#&gt; 12       13     -8</span></span></code></pre></div>
<p>Note that in the case of <code><a href="../reference/method.html">method_bayes()</a></code> or <code><a href="../reference/method.html">method_approxbayes()</a></code>, all imputed datasets correspond to random imputations on the original dataset.
For <code><a href="../reference/method.html">method_condmean()</a></code>, the first imputed dataset will always correspond to the completed original dataset containing all subjects.
For <code>method_condmean(type="jackknife")</code>, the remaining datasets correspond to conditional mean imputations on leave-one-subject-out datasets,
whereas for <code>method_condmean(type="bootstrap")</code>, each subsequent dataset corresponds to a conditional mean imputation on a bootstrapped datasets.
For <code><a href="../reference/method.html">method_bmlmi()</a></code>, all the imputed datasets correspond to sets of random imputations on bootstrapped datasets.</p>
</div>
<div class="section level2" number="5">
<h2 id="analyse">
<span class="header-section-number">5</span> Analyse<a class="anchor" aria-label="anchor" href="#analyse"></a>
</h2>
<p>The next step is to run the analysis model on each imputed dataset. This is done by defining
an analysis function and then calling <code><a href="../reference/analyse.html">analyse()</a></code> to apply this function to each
imputed dataset. For this vignette we use the <code><a href="../reference/ancova.html">ancova()</a></code> function provided by the rbmi
package which fits a separate ANCOVA model for the outcomes from each visit and returns a treatment
effect estimate and corresponding least square means for each group per visit.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">anaObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyse.html">analyse</a></span><span class="op">(</span></span>
<span>    <span class="va">imputeObj</span>,</span>
<span>    <span class="va">ancova</span>,</span>
<span>    vars <span class="op">=</span> <span class="fu"><a href="../reference/set_vars.html">set_vars</a></span><span class="op">(</span></span>
<span>        subjid <span class="op">=</span> <span class="st">"PATIENT"</span>,</span>
<span>        outcome <span class="op">=</span> <span class="st">"CHANGE"</span>,</span>
<span>        visit <span class="op">=</span> <span class="st">"VISIT"</span>,</span>
<span>        group <span class="op">=</span> <span class="st">"THERAPY"</span>,</span>
<span>        covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BASVAL"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">anaObj</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Analysis Object</span></span>
<span><span class="co">#&gt; ---------------</span></span>
<span><span class="co">#&gt; Number of Results: 150</span></span>
<span><span class="co">#&gt; Analysis Function: ancova</span></span>
<span><span class="co">#&gt; Delta Applied: FALSE</span></span>
<span><span class="co">#&gt; Analysis Estimates:</span></span>
<span><span class="co">#&gt;     trt_4</span></span>
<span><span class="co">#&gt;     lsm_ref_4</span></span>
<span><span class="co">#&gt;     lsm_alt_4</span></span>
<span><span class="co">#&gt;     trt_5</span></span>
<span><span class="co">#&gt;     lsm_ref_5</span></span>
<span><span class="co">#&gt;     lsm_alt_5</span></span>
<span><span class="co">#&gt;     trt_6</span></span>
<span><span class="co">#&gt;     lsm_ref_6</span></span>
<span><span class="co">#&gt;     lsm_alt_6</span></span>
<span><span class="co">#&gt;     trt_7</span></span>
<span><span class="co">#&gt;     lsm_ref_7</span></span>
<span><span class="co">#&gt;     lsm_alt_7</span></span></code></pre></div>
<p>Note that, similar to <code><a href="../reference/draws.html">draws()</a></code>, the <code><a href="../reference/ancova.html">ancova()</a></code> function uses the <code><a href="../reference/set_vars.html">set_vars()</a></code>
function which determines the names of the key variables within the data and the covariates
(in addition to the treatment group) for which the analysis model will be adjusted.</p>
<p>Please also note that the names of the analysis estimates contain “ref” and “alt” to refer to the two treatment arms. In particular “ref” refers to the first factor level of <code>vars$group</code> which does not necessarily
coincide with the control arm. In this example, since <code>levels(dat[[vars$group]]) = c("DRUG", PLACEBO</code>), the results associated with “ref” correspond to the intervention arm, while those associated with “alt” correspond to the control arm.</p>
<p>Additionally, we can use the <code>delta</code> argument of <code><a href="../reference/analyse.html">analyse()</a></code> to perform a delta adjustments of the imputed datasets prior to the analysis.
In brief, this is implemented by specifying a data.frame that contains the amount
of adjustment to be added to each longitudinal outcome for each subject and visit, i.e. 
the data.frame must contain the columns <code>subjid</code>, <code>visit</code>, and <code>delta</code>.</p>
<p>It is appreciated that carrying out this procedure is potentially tedious, therefore the
<code><a href="../reference/delta_template.html">delta_template()</a></code> helper function has been provided to simplify it. In particular,
<code><a href="../reference/delta_template.html">delta_template()</a></code> returns a shell <code>data.frame</code> where the delta-adjustment is set to 0 for all
patients. Additionally <code><a href="../reference/delta_template.html">delta_template()</a></code> adds several meta-variables onto the shell
<code>data.frame</code> which can be used for manual derivation or manipulation of the delta-adjustment.</p>
<p>For example lets say we want to add a delta-value of 5 to all imputed values (i.e. those values
which were missing in the original dataset) in the drug arm. That could then be implemented as follows:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For reference show the additional meta variables provided</span></span>
<span><span class="fu"><a href="../reference/delta_template.html">delta_template</a></span><span class="op">(</span><span class="va">imputeObj</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 688 × 8</span></span></span>
<span><span class="co">#&gt;    PATIENT VISIT THERAPY is_mar is_missing is_post_ice strategy delta</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1503    4     DRUG    TRUE   FALSE      FALSE       <span style="color: #BB0000;">NA</span>           0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1503    5     DRUG    TRUE   FALSE      FALSE       <span style="color: #BB0000;">NA</span>           0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1503    6     DRUG    TRUE   FALSE      FALSE       <span style="color: #BB0000;">NA</span>           0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1503    7     DRUG    TRUE   FALSE      FALSE       <span style="color: #BB0000;">NA</span>           0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 1507    4     PLACEBO TRUE   FALSE      FALSE       <span style="color: #BB0000;">NA</span>           0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 1507    5     PLACEBO TRUE   FALSE      FALSE       <span style="color: #BB0000;">NA</span>           0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 1507    6     PLACEBO TRUE   FALSE      FALSE       <span style="color: #BB0000;">NA</span>           0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 1507    7     PLACEBO TRUE   FALSE      FALSE       <span style="color: #BB0000;">NA</span>           0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 1509    4     DRUG    TRUE   FALSE      FALSE       <span style="color: #BB0000;">NA</span>           0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 1509    5     DRUG    TRUE   FALSE      FALSE       <span style="color: #BB0000;">NA</span>           0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 678 more rows</span></span></span>
<span></span>
<span><span class="va">delta_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/delta_template.html">delta_template</a></span><span class="op">(</span><span class="va">imputeObj</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>delta <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">THERAPY</span> <span class="op">==</span> <span class="st">"DRUG"</span> <span class="op">&amp;</span> <span class="va">is_missing</span> , <span class="fl">5</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">PATIENT</span>, <span class="va">VISIT</span>, <span class="va">delta</span><span class="op">)</span></span>
<span>    </span>
<span><span class="va">delta_df</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 688 × 3</span></span></span>
<span><span class="co">#&gt;    PATIENT VISIT delta</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1503    4         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1503    5         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1503    6         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1503    7         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 1507    4         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 1507    5         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 1507    6         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 1507    7         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 1509    4         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 1509    5         0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 678 more rows</span></span></span>
<span></span>
<span><span class="va">anaObj_delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyse.html">analyse</a></span><span class="op">(</span></span>
<span>    <span class="va">imputeObj</span>,</span>
<span>    <span class="va">ancova</span>,</span>
<span>    delta <span class="op">=</span> <span class="va">delta_df</span>,</span>
<span>    vars <span class="op">=</span> <span class="fu"><a href="../reference/set_vars.html">set_vars</a></span><span class="op">(</span></span>
<span>        subjid <span class="op">=</span> <span class="st">"PATIENT"</span>,</span>
<span>        outcome <span class="op">=</span> <span class="st">"CHANGE"</span>,</span>
<span>        visit <span class="op">=</span> <span class="st">"VISIT"</span>,</span>
<span>        group <span class="op">=</span> <span class="st">"THERAPY"</span>,</span>
<span>        covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BASVAL"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2" number="6">
<h2 id="pool">
<span class="header-section-number">6</span> Pool<a class="anchor" aria-label="anchor" href="#pool"></a>
</h2>
<p>Finally, the <code><a href="../reference/pool.html">pool()</a></code> function can be used to summarise the analysis results across multiple
imputed datasets to provide an overall statistic with a standard error, confidence intervals and a p-value for
the hypothesis test of the null hypothesis that the effect is equal to 0.</p>
<p>Note that the pooling method is automatically derived based on the method that was specified
in the original call to <code><a href="../reference/draws.html">draws()</a></code>:</p>
<ul>
<li>For <code><a href="../reference/method.html">method_bayes()</a></code> or <code><a href="../reference/method.html">method_approxbayes()</a></code> pooling and inference are based on Rubin’s rules.</li>
<li>For <code>method_condmean(type = "bootstrap")</code> inference is either based on a normal approximation using the bootstrap standard error (<code>pool(..., type = "normal")</code>) or on the bootstrap percentiles (<code>pool(..., type = "percentile")</code>).</li>
<li>For <code>method_condmean(type = "jackknife")</code> inference is based on a normal approximation using the jackknife estimate of the standard error.</li>
<li>For <code>method = method_bmlmi()</code> inference is according to the methods described by von Hippel and Bartlett (see the <code>stat_specs</code> vignette for details)</li>
</ul>
<p>Since we have used Bayesian multiple imputation in this vignette, the <code><a href="../reference/pool.html">pool()</a></code> function will automatically use Rubin’s rules.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poolObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pool.html">pool</a></span><span class="op">(</span></span>
<span>    <span class="va">anaObj</span>, </span>
<span>    conf.level <span class="op">=</span> <span class="fl">0.95</span>, </span>
<span>    alternative <span class="op">=</span> <span class="st">"two.sided"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">poolObj</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Pool Object</span></span>
<span><span class="co">#&gt; -----------</span></span>
<span><span class="co">#&gt; Number of Results Combined: 150</span></span>
<span><span class="co">#&gt; Method: rubin</span></span>
<span><span class="co">#&gt; Confidence Level: 0.95</span></span>
<span><span class="co">#&gt; Alternative: two.sided</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Results:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   ==================================================</span></span>
<span><span class="co">#&gt;    parameter   est     se     lci     uci     pval  </span></span>
<span><span class="co">#&gt;   --------------------------------------------------</span></span>
<span><span class="co">#&gt;      trt_4    -0.092  0.683  -1.439  1.256   0.893  </span></span>
<span><span class="co">#&gt;    lsm_ref_4  -1.616  0.486  -2.576  -0.656  0.001  </span></span>
<span><span class="co">#&gt;    lsm_alt_4  -1.708  0.475  -2.645  -0.77   &lt;0.001 </span></span>
<span><span class="co">#&gt;      trt_5    1.281   0.927  -0.55   3.112   0.169  </span></span>
<span><span class="co">#&gt;    lsm_ref_5  -4.112  0.661  -5.418  -2.807  &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_alt_5  -2.831  0.646  -4.107  -1.556  &lt;0.001 </span></span>
<span><span class="co">#&gt;      trt_6    1.912   1.001  -0.066   3.89   0.058  </span></span>
<span><span class="co">#&gt;    lsm_ref_6  -6.097  0.714  -7.508  -4.686  &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_alt_6  -4.186  0.696  -5.561  -2.81   &lt;0.001 </span></span>
<span><span class="co">#&gt;      trt_7    2.079   1.122  -0.138  4.296   0.066  </span></span>
<span><span class="co">#&gt;    lsm_ref_7  -6.946  0.815  -8.558  -5.335  &lt;0.001 </span></span>
<span><span class="co">#&gt;    lsm_alt_7  -4.867  0.788  -6.426  -3.308  &lt;0.001 </span></span>
<span><span class="co">#&gt;   --------------------------------------------------</span></span></code></pre></div>
<p>The table of values shown in the print message for <code>poolObj</code> can also be extracted using the <code><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame()</a></code> function:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">poolObj</span><span class="op">)</span></span>
<span><span class="co">#&gt;    parameter         est        se         lci        uci         pval</span></span>
<span><span class="co">#&gt; 1      trt_4 -0.09180645 0.6826279 -1.43949684  1.2558839 8.931772e-01</span></span>
<span><span class="co">#&gt; 2  lsm_ref_4 -1.61581996 0.4862316 -2.57577141 -0.6558685 1.093708e-03</span></span>
<span><span class="co">#&gt; 3  lsm_alt_4 -1.70762640 0.4749573 -2.64531931 -0.7699335 4.262148e-04</span></span>
<span><span class="co">#&gt; 4      trt_5  1.28107134 0.9269270 -0.54967136  3.1118141 1.689000e-01</span></span>
<span><span class="co">#&gt; 5  lsm_ref_5 -4.11245871 0.6608409 -5.41768364 -2.8072338 4.201381e-09</span></span>
<span><span class="co">#&gt; 6  lsm_alt_5 -2.83138737 0.6457744 -4.10686302 -1.5559117 2.114628e-05</span></span>
<span><span class="co">#&gt; 7      trt_6  1.91163968 1.0011368 -0.06637259  3.8896520 5.809419e-02</span></span>
<span><span class="co">#&gt; 8  lsm_ref_6 -6.09716631 0.7142461 -7.50839192 -4.6859407 1.384720e-14</span></span>
<span><span class="co">#&gt; 9  lsm_alt_6 -4.18552662 0.6963163 -5.56127560 -2.8097776 1.321956e-08</span></span>
<span><span class="co">#&gt; 10     trt_7  2.07945506 1.1216355 -0.13755657  4.2964667 6.579390e-02</span></span>
<span><span class="co">#&gt; 11 lsm_ref_7 -6.94648032 0.8150602 -8.55819661 -5.3347640 2.515736e-14</span></span>
<span><span class="co">#&gt; 12 lsm_alt_7 -4.86702525 0.7884953 -6.42588823 -3.3081623 6.801566e-09</span></span></code></pre></div>
<p>These outputs gives an estimated difference of
2.079 (95% CI -0.138 to 4.296)
between the two groups at the last visit with an associated p-value of 0.066.</p>
</div>
<div class="section level2" number="7">
<h2 id="code">
<span class="header-section-number">7</span> Code<a class="anchor" aria-label="anchor" href="#code"></a>
</h2>
<p>We report below all the code presented in this vignette.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://insightsengineering.github.io/rbmi/" class="external-link">rbmi</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"antidepressant_data"</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">antidepressant_data</span></span>
<span></span>
<span><span class="co"># Use expand_locf to add rows corresponding to visits with missing outcomes to the dataset</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/expand.html">expand_locf</a></span><span class="op">(</span></span>
<span>    <span class="va">dat</span>,</span>
<span>    PATIENT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">PATIENT</span><span class="op">)</span>, <span class="co"># expand by PATIENT and VISIT </span></span>
<span>    VISIT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">VISIT</span><span class="op">)</span>,</span>
<span>    vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BASVAL"</span>, <span class="st">"THERAPY"</span><span class="op">)</span>, <span class="co"># fill with LOCF BASVAL and THERAPY</span></span>
<span>    group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PATIENT"</span><span class="op">)</span>,</span>
<span>    order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PATIENT"</span>, <span class="st">"VISIT"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create data_ice and set the imputation strategy to JR for</span></span>
<span><span class="co"># each patient with at least one missing observation</span></span>
<span><span class="va">dat_ice</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">PATIENT</span>, <span class="va">VISIT</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">CHANGE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">PATIENT</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">PATIENT</span>, <span class="va">VISIT</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>strategy <span class="op">=</span> <span class="st">"JR"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># In this dataset, subject 3618 has an intermittent missing values which does not correspond</span></span>
<span><span class="co"># to a study drug discontinuation. We therefore remove this subject from `dat_ice`. </span></span>
<span><span class="co"># (In the later imputation step, it will automatically be imputed under the default MAR assumption.)</span></span>
<span><span class="va">dat_ice</span> <span class="op">&lt;-</span> <span class="va">dat_ice</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">dat_ice</span><span class="op">$</span><span class="va">PATIENT</span> <span class="op">==</span> <span class="fl">3618</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># Define the names of key variables in our dataset using `set_vars()`</span></span>
<span><span class="co"># and the covariates included in the imputation model</span></span>
<span><span class="co"># Note that the covariates argument can also include interaction terms</span></span>
<span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_vars.html">set_vars</a></span><span class="op">(</span></span>
<span>    outcome <span class="op">=</span> <span class="st">"CHANGE"</span>,</span>
<span>    visit <span class="op">=</span> <span class="st">"VISIT"</span>,</span>
<span>    subjid <span class="op">=</span> <span class="st">"PATIENT"</span>,</span>
<span>    group <span class="op">=</span> <span class="st">"THERAPY"</span>,</span>
<span>    covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BASVAL*VISIT"</span>, <span class="st">"THERAPY*VISIT"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define which imputation method to use (here: Bayesian multiple imputation with 150 imputed datsets) </span></span>
<span><span class="va">method</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/method.html">method_bayes</a></span><span class="op">(</span></span>
<span>    burn_in <span class="op">=</span> <span class="fl">200</span>,</span>
<span>    burn_between <span class="op">=</span> <span class="fl">5</span>,</span>
<span>    n_samples <span class="op">=</span> <span class="fl">150</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">675442751</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Create samples for the imputation parameters by running the draws() function</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">987</span><span class="op">)</span></span>
<span><span class="va">drawObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draws.html">draws</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">dat</span>,</span>
<span>    data_ice <span class="op">=</span> <span class="va">dat_ice</span>,</span>
<span>    vars <span class="op">=</span> <span class="va">vars</span>,</span>
<span>    method <span class="op">=</span> <span class="va">method</span>,</span>
<span>    quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Impute the data</span></span>
<span><span class="va">imputeObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/impute.html">impute</a></span><span class="op">(</span></span>
<span>    <span class="va">drawObj</span>,</span>
<span>    references <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DRUG"</span> <span class="op">=</span> <span class="st">"PLACEBO"</span>, <span class="st">"PLACEBO"</span> <span class="op">=</span> <span class="st">"PLACEBO"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit the analysis model on each imputed dataset</span></span>
<span><span class="va">anaObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyse.html">analyse</a></span><span class="op">(</span></span>
<span>    <span class="va">imputeObj</span>,</span>
<span>    <span class="va">ancova</span>,</span>
<span>    vars <span class="op">=</span> <span class="fu"><a href="../reference/set_vars.html">set_vars</a></span><span class="op">(</span></span>
<span>        subjid <span class="op">=</span> <span class="st">"PATIENT"</span>,</span>
<span>        outcome <span class="op">=</span> <span class="st">"CHANGE"</span>,</span>
<span>        visit <span class="op">=</span> <span class="st">"VISIT"</span>,</span>
<span>        group <span class="op">=</span> <span class="st">"THERAPY"</span>,</span>
<span>        covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BASVAL"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply a delta adjustment</span></span>
<span></span>
<span><span class="co"># Add a delta-value of 5 to all imputed values (i.e. those values</span></span>
<span><span class="co"># which were missing in the original dataset) in the drug arm.</span></span>
<span><span class="va">delta_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/delta_template.html">delta_template</a></span><span class="op">(</span><span class="va">imputeObj</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>delta <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">THERAPY</span> <span class="op">==</span> <span class="st">"DRUG"</span> <span class="op">&amp;</span> <span class="va">is_missing</span> , <span class="fl">5</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">PATIENT</span>, <span class="va">VISIT</span>, <span class="va">delta</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Repeat the analyses with the adjusted values</span></span>
<span><span class="va">anaObj_delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyse.html">analyse</a></span><span class="op">(</span></span>
<span>    <span class="va">imputeObj</span>,</span>
<span>    <span class="va">ancova</span>,</span>
<span>    delta <span class="op">=</span> <span class="va">delta_df</span>,</span>
<span>    vars <span class="op">=</span> <span class="fu"><a href="../reference/set_vars.html">set_vars</a></span><span class="op">(</span></span>
<span>        subjid <span class="op">=</span> <span class="st">"PATIENT"</span>,</span>
<span>        outcome <span class="op">=</span> <span class="st">"CHANGE"</span>,</span>
<span>        visit <span class="op">=</span> <span class="st">"VISIT"</span>,</span>
<span>        group <span class="op">=</span> <span class="st">"THERAPY"</span>,</span>
<span>        covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BASVAL"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Pool the results</span></span>
<span><span class="va">poolObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pool.html">pool</a></span><span class="op">(</span></span>
<span>    <span class="va">anaObj</span>, </span>
<span>    conf.level <span class="op">=</span> <span class="fl">0.95</span>, </span>
<span>    alternative <span class="op">=</span> <span class="st">"two.sided"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Craig Gower-Page, Alessandro Noci, Roche.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
