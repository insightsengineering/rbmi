<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Create imputed datasets — impute • rbmi</title><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create imputed datasets — impute"><meta name="description" content='impute() creates imputed datasets based upon the data and options specified in
the call to draws(). One imputed dataset is created per each "sample" created by
draws().'><meta property="og:description" content='impute() creates imputed datasets based upon the data and options specified in
the call to draws(). One imputed dataset is created per each "sample" created by
draws().'><meta property="og:image" content="https://insightsengineering.github.io/rbmi/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rbmi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.5.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/quickstart.html">rbmi: Quickstart</a></li>
    <li><a class="dropdown-item" href="../articles/stat_specs.html">rbmi: Statistical Specifications</a></li>
    <li><a class="dropdown-item" href="../articles/advanced.html">rbmi: Advanced Functionality</a></li>
    <li><a class="dropdown-item" href="../articles/retrieved_dropout.html">rbmi: Implementation of retrieved-dropout models using rbmi</a></li>
    <li><a class="dropdown-item" href="../articles/CondMean_Inference.html">rbmi: Inference with Conditional Mean Imputation</a></li>
    <li><a class="dropdown-item" href="../articles/FAQ.html">rbmi: Frequently Asked Questions</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/insightsengineering/rbmi/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Create imputed datasets</h1>
      <small class="dont-index">Source: <a href="https://github.com/insightsengineering/rbmi/blob/main/R/impute.R" class="external-link"><code>R/impute.R</code></a></small>
      <div class="d-none name"><code>impute.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>impute()</code> creates imputed datasets based upon the data and options specified in
the call to <code><a href="draws.html">draws()</a></code>. One imputed dataset is created per each "sample" created by
<code><a href="draws.html">draws()</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">impute</span><span class="op">(</span></span>
<span>  <span class="va">draws</span>,</span>
<span>  references <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  update_strategy <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  strategies <span class="op">=</span> <span class="fu"><a href="getStrategies.html">getStrategies</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'random'</span></span>
<span><span class="fu">impute</span><span class="op">(</span></span>
<span>  <span class="va">draws</span>,</span>
<span>  references <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  update_strategy <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  strategies <span class="op">=</span> <span class="fu"><a href="getStrategies.html">getStrategies</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'condmean'</span></span>
<span><span class="fu">impute</span><span class="op">(</span></span>
<span>  <span class="va">draws</span>,</span>
<span>  references <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  update_strategy <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  strategies <span class="op">=</span> <span class="fu"><a href="getStrategies.html">getStrategies</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-draws">draws<a class="anchor" aria-label="anchor" href="#arg-draws"></a></dt>
<dd><p>A <code>draws</code> object created by <code><a href="draws.html">draws()</a></code>.</p></dd>


<dt id="arg-references">references<a class="anchor" aria-label="anchor" href="#arg-references"></a></dt>
<dd><p>A named vector. Identifies the references to be used for reference-based
imputation methods. Should be of the form <code>c("Group1" = "Reference1", "Group2" = "Reference2")</code>.
If <code>NULL</code> (default), the references are assumed to be of the form
<code>c("Group1" = "Group1", "Group2" = "Group2")</code>. This argument cannot be <code>NULL</code> if
an imputation strategy (as defined by <code>data_ice[[vars$strategy]]</code> in the call to <a href="draws.html">draws</a>) other than <code>MAR</code> is set.</p></dd>


<dt id="arg-update-strategy">update_strategy<a class="anchor" aria-label="anchor" href="#arg-update-strategy"></a></dt>
<dd><p>An optional <code>data.frame</code>. Updates the imputation method that was
originally set via the <code>data_ice</code> option in <code><a href="draws.html">draws()</a></code>. See the details section for more
information.</p></dd>


<dt id="arg-strategies">strategies<a class="anchor" aria-label="anchor" href="#arg-strategies"></a></dt>
<dd><p>A named list of functions. Defines the imputation functions to be used.
The names of the list should mirror the values specified in <code>strategy</code> column of <code>data_ice</code>.
Default = <code><a href="getStrategies.html">getStrategies()</a></code>. See <code><a href="getStrategies.html">getStrategies()</a></code> for more details.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>impute()</code> uses the imputation model parameter estimates, as generated by <code><a href="draws.html">draws()</a></code>, to
first calculate the marginal (multivariate normal) distribution of a subject's longitudinal
outcome variable
depending on their covariate values.
For subjects with intercurrent events (ICEs) handled using non-MAR methods, this marginal distribution
is then updated depending on the time of the first visit affected by the ICE,
the chosen imputation strategy and the chosen reference group as described in Carpenter, Roger, and Kenward (2013) .
The subject's imputation distribution used for imputing missing values is then defined as
their marginal distribution conditional on their observed outcome values.
One dataset is being generated per set of parameter estimates provided by <code><a href="draws.html">draws()</a></code>.</p>
<p>The exact manner in how missing values are imputed from this conditional imputation distribution depends
on the <code>method</code> object that was provided to <code><a href="draws.html">draws()</a></code>, in particular:</p><ul><li><p>Bayes &amp; Approximate Bayes: each imputed dataset contains 1 row per subject &amp; visit
from the original dataset with missing values imputed by taking a single random sample
from the conditional imputation distribution.</p></li>
<li><p>Conditional Mean: each imputed dataset contains 1 row per subject &amp; visit from the
bootstrapped or jackknife dataset that was used to generate the corresponding parameter
estimates in <code><a href="draws.html">draws()</a></code>. Missing values are imputed by using the mean of the conditional
imputation distribution. Please note that the first imputed dataset refers to the conditional
mean imputation on the original dataset whereas all subsequent imputed datasets refer to
conditional mean imputations for bootstrap or jackknife samples, respectively, of the original data.</p></li>
<li><p>Bootstrapped Maximum Likelihood MI (BMLMI): it performs <code>D</code> random imputations of each bootstrapped
dataset that was used to generate the corresponding parameter estimates in <code><a href="draws.html">draws()</a></code>. A total number of
<code>B*D</code> imputed datasets is provided, where <code>B</code> is the number of bootstrapped datasets. Missing values
are imputed by taking a random sample from the conditional imputation distribution.</p></li>
</ul><p>The <code>update_strategy</code> argument can be used to update the imputation strategy that was
originally set via the <code>data_ice</code> option in <code><a href="draws.html">draws()</a></code>. This avoids having to re-run the <code><a href="draws.html">draws()</a></code>
function when changing the imputation strategy in certain circumstances (as detailed below).
The <code>data.frame</code> provided to <code>update_strategy</code> argument must contain two columns,
one for the subject ID and another for the imputation strategy, whose names are the same as
those defined in the <code>vars</code> argument as specified in the call to <code><a href="draws.html">draws()</a></code>. Please note that this
argument only allows you to update the imputation strategy and not other arguments such as the
time of the first visit affected by the ICE.
A key limitation of this functionality is
that one can only switch between a MAR and a non-MAR strategy (or vice versa) for subjects without
observed post-ICE data. The reason for this is that such a change would affect whether the post-ICE data is included
in the base imputation model or not (as explained in the help to <code><a href="draws.html">draws()</a></code>).
As an example, if a subject had their ICE on "Visit 2"
but had observed/known values for "Visit 3" then the function will throw an error
if one tries to switch the strategy from MAR to a non-MAR strategy. In contrast, switching from
a non-MAR to a MAR strategy, whilst valid, will raise a warning as not all usable data
will have been utilised in the imputation model.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>James R Carpenter, James H Roger, and Michael G Kenward. Analysis of longitudinal trials with protocol deviation:
a framework for relevant,
accessible assumptions, and inference via multiple imputation. Journal of Biopharmaceutical Statistics,
23(6):1352–1371, 2013. [Section 4.2 and 4.3]</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">impute</span><span class="op">(</span></span></span>
<span class="r-in"><span>    draws <span class="op">=</span> <span class="va">drawobj</span>,</span></span>
<span class="r-in"><span>    references <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Trt"</span> <span class="op">=</span> <span class="st">"Placebo"</span>, <span class="st">"Placebo"</span> <span class="op">=</span> <span class="st">"Placebo"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">new_strategy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  subjid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Pt1"</span>, <span class="st">"Pt2"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  strategy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MAR"</span>, <span class="st">"JR"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">impute</span><span class="op">(</span></span></span>
<span class="r-in"><span>    draws <span class="op">=</span> <span class="va">drawobj</span>,</span></span>
<span class="r-in"><span>    references <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Trt"</span> <span class="op">=</span> <span class="st">"Placebo"</span>, <span class="st">"Placebo"</span> <span class="op">=</span> <span class="st">"Placebo"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    update_strategy <span class="op">=</span> <span class="va">new_strategy</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Craig Gower-Page, Isaac Gravestock, Alessandro Noci, Daniel Sabanes Bove, F. Hoffmann-La Roche AG.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

