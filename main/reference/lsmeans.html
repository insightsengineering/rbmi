<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Least Square Means — lsmeans • rbmi</title><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Least Square Means — lsmeans"><meta name="description" content="Estimates the least square means from a linear model. The exact implementation
/ interpretation depends on the weighting scheme; see the weighting section for more
information."><meta property="og:description" content="Estimates the least square means from a linear model. The exact implementation
/ interpretation depends on the weighting scheme; see the weighting section for more
information."><meta property="og:image" content="https://insightsengineering.github.io/rbmi/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rbmi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.5.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/quickstart.html">rbmi: Quickstart</a></li>
    <li><a class="dropdown-item" href="../articles/stat_specs.html">rbmi: Statistical Specifications</a></li>
    <li><a class="dropdown-item" href="../articles/advanced.html">rbmi: Advanced Functionality</a></li>
    <li><a class="dropdown-item" href="../articles/retrieved_dropout.html">rbmi: Implementation of retrieved-dropout models using rbmi</a></li>
    <li><a class="dropdown-item" href="../articles/CondMean_Inference.html">rbmi: Inference with Conditional Mean Imputation</a></li>
    <li><a class="dropdown-item" href="../articles/FAQ.html">rbmi: Frequently Asked Questions</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/insightsengineering/rbmi/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Least Square Means</h1>
      <small class="dont-index">Source: <a href="https://github.com/insightsengineering/rbmi/blob/main/R/lsmeans.R" class="external-link"><code>R/lsmeans.R</code></a></small>
      <div class="d-none name"><code>lsmeans.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Estimates the least square means from a linear model. The exact implementation
/ interpretation depends on the weighting scheme; see the weighting section for more
information.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">lsmeans</span><span class="op">(</span></span>
<span>  <span class="va">model</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  .weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"counterfactual"</span>, <span class="st">"equal"</span>, <span class="st">"proportional_em"</span>, <span class="st">"proportional"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>A model created by <code>lm</code>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Fixes specific variables to specific values i.e.
<code>trt = 1</code> or <code>age = 50</code>. The name of the argument must be the name
of the variable within the dataset.</p></dd>


<dt id="arg--weights">.weights<a class="anchor" aria-label="anchor" href="#arg--weights"></a></dt>
<dd><p>Character, either <code>"counterfactual"</code> (default), <code>"equal"</code>,
<code>"proportional_em"</code> or <code>"proportional"</code>.
Specifies the weighting strategy to be used when calculating the lsmeans.
See the weighting section for more details.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="weighting">Weighting<a class="anchor" aria-label="anchor" href="#weighting"></a></h2>


<div class="section">
<h3 id="counterfactual">Counterfactual<a class="anchor" aria-label="anchor" href="#counterfactual"></a></h3>


<p>For <code>weights = "counterfactual"</code> (the default) the lsmeans are obtained by
taking the average of the predicted values for each patient after assigning all patients
to each arm in turn.
This approach is equivalent to standardization or g-computation.
In comparison to <code>emmeans</code> this approach is equivalent to:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>emmeans<span class="sc">::</span><span class="fu">emmeans</span>(model, <span class="at">specs =</span> <span class="st">"&lt;treatment&gt;"</span>, <span class="at">counterfactual =</span> <span class="st">"&lt;treatment&gt;"</span>)</span></code></pre><p></p></div>
<p>Note that to ensure backwards compatibility with previous versions of <code>rbmi</code>
<code>weights = "proportional"</code> is an alias for <code>weights = "counterfactual"</code>.
To get results consistent with <code>emmeans</code>'s <code>weights = "proportional"</code>
please use <code>weights = "proportional_em"</code>.</p>
</div>

<div class="section">
<h3 id="equal">Equal<a class="anchor" aria-label="anchor" href="#equal"></a></h3>


<p>For <code>weights = "equal"</code> the lsmeans are obtained by taking the model fitted
value of a hypothetical patient whose covariates are defined as follows:</p><ul><li><p>Continuous covariates are set to <code>mean(X)</code></p></li>
<li><p>Dummy categorical variables are set to <code>1/N</code> where <code>N</code> is the number of levels</p></li>
<li><p>Continuous * continuous interactions are set to <code>mean(X) * mean(Y)</code></p></li>
<li><p>Continuous * categorical interactions are set to <code>mean(X) * 1/N</code></p></li>
<li><p>Dummy categorical * categorical interactions are set to <code>1/N * 1/M</code></p></li>
</ul><p>In comparison to <code>emmeans</code> this approach is equivalent to:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>emmeans<span class="sc">::</span><span class="fu">emmeans</span>(model, <span class="at">specs =</span> <span class="st">"&lt;treatment&gt;"</span>, <span class="at">weights =</span> <span class="st">"equal"</span>)</span></code></pre><p></p></div>
</div>

<div class="section">
<h3 id="proportional">Proportional<a class="anchor" aria-label="anchor" href="#proportional"></a></h3>


<p>For <code>weights = "proportional_em"</code> the lsmeans are obtained as per <code>weights = "equal"</code>
except instead of weighting each observation equally they are weighted by the proportion
in which the given combination of categorical values occurred in the data.
In comparison to <code>emmeans</code> this approach is equivalent to:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>emmeans<span class="sc">::</span><span class="fu">emmeans</span>(model, <span class="at">specs =</span> <span class="st">"&lt;treatment&gt;"</span>, <span class="at">weights =</span> <span class="st">"proportional"</span>)</span></code></pre><p></p></div>
<p>Note that this is not to be confused with <code>weights = "proportional"</code> which is an alias
for <code>weights = "counterfactual"</code>.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="fixing">Fixing<a class="anchor" aria-label="anchor" href="#fixing"></a></h2>



<p>Regardless of the weighting scheme any named arguments passed via <code>...</code> will
fix the value of the covariate to the specified value.
For example, <code>lsmeans(model, trt = "A")</code> will fix the dummy variable <code>trtA</code> to 1
for all patients (real or hypothetical) when calculating the lsmeans.</p>
<p>See the references for similar implementations as done in SAS and
in R via the <code>emmeans</code> package.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p><a href="https://CRAN.R-project.org/package=emmeans" class="external-link">https://CRAN.R-project.org/package=emmeans</a></p>
<p><a href="https://documentation.sas.com/doc/en/pgmsascdc/9.4_3.3/statug/statug_glm_details41.htm" class="external-link">https://documentation.sas.com/doc/en/pgmsascdc/9.4_3.3/statug/statug_glm_details41.htm</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Sepal.Length</span> <span class="op">~</span> <span class="va">Species</span> <span class="op">+</span> <span class="va">Petal.Length</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">lsmeans</span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">lsmeans</span><span class="op">(</span><span class="va">mod</span>, Species <span class="op">=</span> <span class="st">"virginica"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">lsmeans</span><span class="op">(</span><span class="va">mod</span>, Species <span class="op">=</span> <span class="st">"versicolor"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">lsmeans</span><span class="op">(</span><span class="va">mod</span>, Species <span class="op">=</span> <span class="st">"versicolor"</span>, Petal.Length <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Isaac Gravestock, Craig Gower-Page, Alessandro Noci, Daniel Sabanes Bove, F. Hoffmann-La Roche AG.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

