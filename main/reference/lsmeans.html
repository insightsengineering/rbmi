<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Estimates the least square means from a linear model. The exact implementation
/ interpretation depends on the weighting scheme; see the weighting section for more
information."><title>Least Square Means — lsmeans • rbmi</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Least Square Means — lsmeans"><meta property="og:description" content="Estimates the least square means from a linear model. The exact implementation
/ interpretation depends on the weighting scheme; see the weighting section for more
information."><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rbmi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.6</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/CondMean_Inference.html">rbmi: Inference with Conditional Mean Imputation</a>
    <a class="dropdown-item" href="../articles/FAQ.html">rbmi: Frequently Asked Questions</a>
    <a class="dropdown-item" href="../articles/advanced.html">rbmi: Advanced Functionality</a>
    <a class="dropdown-item" href="../articles/quickstart.html">rbmi: Quickstart</a>
    <a class="dropdown-item" href="../articles/stat_specs.html">rbmi: Statistical Specifications</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/insightsengineering/rbmi/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Least Square Means</h1>
      <small class="dont-index">Source: <a href="https://github.com/insightsengineering/rbmi/blob/HEAD/R/lsmeans.R" class="external-link"><code>R/lsmeans.R</code></a></small>
      <div class="d-none name"><code>lsmeans.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Estimates the least square means from a linear model. The exact implementation
/ interpretation depends on the weighting scheme; see the weighting section for more
information.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">lsmeans</span><span class="op">(</span></span>
<span>  <span class="va">model</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  .weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"counterfactual"</span>, <span class="st">"equal"</span>, <span class="st">"proportional_em"</span>, <span class="st">"proportional"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>model</dt>
<dd><p>A model created by <code>lm</code>.</p></dd>


<dt>...</dt>
<dd><p>Fixes specific variables to specific values i.e.
<code>trt = 1</code> or <code>age = 50</code>. The name of the argument must be the name
of the variable within the dataset.</p></dd>


<dt>.weights</dt>
<dd><p>Character, either <code>"counterfactual"</code> (default), <code>"equal"</code>,
<code>"proportional_em"</code> or <code>"proportional"</code>.
Specifies the weighting strategy to be used when calculating the lsmeans.
See the weighting section for more details.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="weighting">Weighting<a class="anchor" aria-label="anchor" href="#weighting"></a></h2>
    

<div class="section">
<h3 id="counterfactual">Counterfactual<a class="anchor" aria-label="anchor" href="#counterfactual"></a></h3>


<p>For <code>weights = "counterfactual"</code> (the default) the lsmeans are obtained by
taking the average of the predicted values for each patient after assigning all patients
to each arm in turn.
This approach is equivalent to standardization or g-computation.
In comparison to <code>emmeans</code> this approach is equivalent to:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>emmeans<span class="sc">::</span><span class="fu">emmeans</span>(model, <span class="at">specs =</span> <span class="st">"&lt;treatment&gt;"</span>, <span class="at">counterfactual =</span> <span class="st">"&lt;treatment&gt;"</span>)</span></code></pre><p></p></div>
<p>Note that to ensure backwards compatibility with previous versions of rbmi
<code>weights = "proportional"</code> is an alias for <code>weights = "counterfactual"</code>.
To get results consistent with <code>emmeans</code>'s <code>weights = "proportional"</code>
please use <code>weights = "proportional_em"</code>.</p>
</div>

<div class="section">
<h3 id="equal">Equal<a class="anchor" aria-label="anchor" href="#equal"></a></h3>


<p>For <code>weights = "equal"</code> the lsmeans are obtained by taking the model fitted
value of a hypothetical patient whose covariates are defined as follows:</p><ul><li><p>Continuous covariates are set to <code>mean(X)</code></p></li>
<li><p>Dummy categorical variables are set to <code>1/N</code> where <code>N</code> is the number of levels</p></li>
<li><p>Continuous * continuous interactions are set to <code>mean(X) * mean(Y)</code></p></li>
<li><p>Continuous * categorical interactions are set to <code>mean(X) * 1/N</code></p></li>
<li><p>Dummy categorical * categorical interactions are set to <code>1/N * 1/M</code></p></li>
</ul><p>In comparison to <code>emmeans</code> this approach is equivalent to:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>emmeans<span class="sc">::</span><span class="fu">emmeans</span>(model, <span class="at">specs =</span> <span class="st">"&lt;treatment&gt;"</span>, <span class="at">weights =</span> <span class="st">"equal"</span>)</span></code></pre><p></p></div>
</div>

<div class="section">
<h3 id="proportional">Proportional<a class="anchor" aria-label="anchor" href="#proportional"></a></h3>


<p>For <code>weights = "proportional_em"</code> the lsmeans are obtained as per <code>weights = "equal"</code>
except instead of weighting each observation equally they are weighted by the proportion
in which the given combination of categorical values occurred in the data.
In comparison to <code>emmeans</code> this approach is equivalent to:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>emmeans<span class="sc">::</span><span class="fu">emmeans</span>(model, <span class="at">specs =</span> <span class="st">"&lt;treatment&gt;"</span>, <span class="at">weights =</span> <span class="st">"proportional"</span>)</span></code></pre><p></p></div>
<p>Note that this is not to be confused with <code>weights = "proportional"</code> which is an alias
for <code>weights = "counterfactual"</code>.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="fixing">Fixing<a class="anchor" aria-label="anchor" href="#fixing"></a></h2>
    


<p>Regardless of the weighting scheme any named arguments passed via <code>...</code> will
fix the value of the covariate to the specified value.
For example, <code>lsmeans(model, trt = "A")</code> will fix the dummy variable <code>trtA</code> to 1
for all patients (real or hypothetical) when calculating the lsmeans.</p>
<p>See the references for similar implementations as done in SAS and
in R via the <code>emmeans</code> package.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p><a href="https://CRAN.R-project.org/package=emmeans" class="external-link">https://CRAN.R-project.org/package=emmeans</a></p>
<p><a href="https://documentation.sas.com/doc/en/pgmsascdc/9.4_3.3/statug/statug_glm_details41.htm" class="external-link">https://documentation.sas.com/doc/en/pgmsascdc/9.4_3.3/statug/statug_glm_details41.htm</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Sepal.Length</span> <span class="op">~</span> <span class="va">Species</span> <span class="op">+</span> <span class="va">Petal.Length</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">lsmeans</span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">lsmeans</span><span class="op">(</span><span class="va">mod</span>, Species <span class="op">=</span> <span class="st">"virginica"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">lsmeans</span><span class="op">(</span><span class="va">mod</span>, Species <span class="op">=</span> <span class="st">"versicolor"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">lsmeans</span><span class="op">(</span><span class="va">mod</span>, Species <span class="op">=</span> <span class="st">"versicolor"</span>, Petal.Length <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Craig Gower-Page, Alessandro Noci, Roche.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

